<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leccion 20: Los Seis Politopos Regulares 4D | Matematicas Visuales</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '\\(', right: '\\)', display: false}]});"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glow-text { text-shadow: 0 0 20px rgba(168, 85, 247, 0.5); }
        .progress-bar { background: linear-gradient(90deg, #a855f7, #22d3ee); }
        .katex { color: inherit; font-size: 1.1em; }
    </style>
</head>
<body class="bg-black text-gray-100 min-h-screen">

    <!-- Header -->
    <header class="bg-gray-950 border-b border-gray-800 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-2 text-sm text-gray-400">
                    <a href="../../index.html" class="hover:text-violet-400 transition">EigenLab</a>
                    <span>/</span>
                    <a href="../../index.html" class="hover:text-violet-400 transition">Math Visual Lab</a>
                    <span>/</span>
                    <a href="../../index.html" class="hover:text-violet-400 transition">Platonic Lab</a>
                    <span>/</span>
                    <a href="../../curso.html" class="hover:text-violet-400 transition">Curso</a>
                    <span>/</span>
                    <span class="text-violet-400">Modulo 04</span>
                </div>
                <nav class="flex space-x-4 text-sm">
                    <a href="./leccion-19.html" class="px-3 py-2 rounded-lg hover:bg-gray-800 text-gray-300 transition">Anterior</a>
                    <a href="./leccion-21.html" class="px-3 py-2 rounded-lg bg-violet-600 hover:bg-violet-500 text-white transition">Siguiente</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">

            <!-- Sidebar -->
            <aside class="lg:col-span-1">
                <div class="bg-gray-950 border border-gray-800 rounded-lg p-6 sticky top-24">
                    <h3 class="text-lg font-semibold mb-1 text-cyan-400">Modulo 4</h3>
                    <p class="text-sm text-gray-500 mb-4">Mas Alla de la 3D</p>
                    <div class="mb-6">
                        <div class="flex justify-between text-xs text-gray-400 mb-2">
                            <span>Progreso</span>
                            <span>2/6</span>
                        </div>
                        <div class="w-full bg-gray-800 rounded-full h-2">
                            <div class="progress-bar h-2 rounded-full" style="width: 33.3%"></div>
                        </div>
                    </div>
                    <nav class="space-y-2">
                        <a href="./leccion-19.html" class="block px-3 py-2 rounded-lg hover:bg-gray-900 text-gray-400 text-sm transition">19. El Salto a la Cuarta Dimension</a>
                        <a href="./leccion-20.html" class="block px-3 py-2 rounded-lg bg-violet-500/10 text-violet-400 text-sm">20. Los Seis Politopos Regulares</a>
                        <a href="./leccion-21.html" class="block px-3 py-2 rounded-lg hover:bg-gray-900 text-gray-400 text-sm transition">21. Euler-Poincare y Dualidad</a>
                        <a href="./leccion-22.html" class="block px-3 py-2 rounded-lg hover:bg-gray-900 text-gray-400 text-sm transition">22. Proyecciones: De 4D a Pantalla</a>
                        <a href="./leccion-23.html" class="block px-3 py-2 rounded-lg hover:bg-gray-900 text-gray-400 text-sm transition">23. Rotaciones en 4D y el 24-celda</a>
                        <a href="./leccion-24.html" class="block px-3 py-2 rounded-lg hover:bg-gray-900 text-gray-400 text-sm transition">24. Dimensiones Superiores y Sintesis</a>
                    </nav>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="lg:col-span-3 space-y-8">

                <!-- Title Block -->
                <div class="bg-gray-950 border border-gray-800 rounded-lg p-8">
                    <p class="text-violet-400 text-sm font-medium mb-2 mono">Leccion 20</p>
                    <h1 class="text-3xl md:text-4xl font-bold mb-4 glow-text text-white">Los Seis Politopos Regulares 4D</h1>
                    <p class="text-gray-400 text-lg">Clasificacion completa de los politopos regulares en cuatro dimensiones, sus coordenadas y propiedades.</p>
                </div>

                <!-- Section 1: Definicion Formal -->
                <section class="bg-gray-950 border border-gray-800 rounded-lg p-8">
                    <h3 class="text-xl font-semibold text-violet-400 mb-4">1. Definicion Formal de Politopo Regular</h3>

                    <p class="text-gray-300 mb-4">Un <strong class="text-white">politopo regular convexo</strong> en \(\mathbb{R}^4\) es una region acotada y convexa delimitada por un numero finito de celdas tridimensionales (poliedros) que satisface las siguientes condiciones:</p>

                    <ul class="list-disc list-inside space-y-3 text-gray-300 mb-6 ml-2">
                        <li>Cada <strong class="text-white">celda</strong> (faceta 3D) es un poliedro regular congruente, es decir, un solido platonico \(\{p, q\}\).</li>
                        <li>Cada <strong class="text-white">arista</strong> del politopo pertenece exactamente a \(r\) celdas.</li>
                        <li>La <strong class="text-white">figura de vertice</strong> -- el politopo formado por los vecinos de cada vertice -- es un poliedro regular \(\{q, r\}\), identico en todos los vertices.</li>
                        <li>Las celdas deben "cerrarse" alrededor de cada arista: la suma de angulos diedros de las \(r\) celdas incidentes debe ser estrictamente menor que \(2\pi\).</li>
                    </ul>

                    <div class="bg-violet-500/5 border border-violet-500/20 rounded-lg p-6 mb-4">
                        <p class="text-gray-300 mb-2">Estas condiciones definen completamente el <strong class="text-white">simbolo de Schlafli</strong> del politopo como la terna:</p>
                        $$ \{p, q, r\} $$
                        <p class="text-gray-400 text-sm mt-2">donde \(\{p, q\}\) es el tipo de celda y \(\{q, r\}\) es la figura de vertice.</p>
                    </div>

                    <p class="text-gray-300">La regularidad en dimension 4 es por tanto una condicion extremadamente restrictiva: exige que el objeto sea "igual" visto desde cualquier vertice, arista, cara o celda. Esto reduce las posibilidades a exactamente seis politopos.</p>
                </section>

                <!-- Section 2: Clasificacion de Schlafli -->
                <section class="bg-gray-950 border border-gray-800 rounded-lg p-8">
                    <h3 class="text-xl font-semibold text-violet-400 mb-4">2. Clasificacion de Schlafli</h3>

                    <p class="text-gray-300 mb-4">La derivacion de los seis politopos regulares procede por eliminacion sistematica. Necesitamos:</p>

                    <div class="bg-gray-900 rounded-lg p-6 mb-6">
                        <p class="text-gray-300 mb-3"><strong class="text-white">Paso 1.</strong> La celda \(\{p, q\}\) debe ser un solido platonico existente. Las cinco opciones son:</p>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-3 text-center mono text-sm">
                            <div class="bg-gray-800 rounded-lg p-3">
                                <p class="text-violet-400">\(\{3,3\}\)</p>
                                <p class="text-gray-500 text-xs mt-1">Tetraedro</p>
                            </div>
                            <div class="bg-gray-800 rounded-lg p-3">
                                <p class="text-violet-400">\(\{4,3\}\)</p>
                                <p class="text-gray-500 text-xs mt-1">Cubo</p>
                            </div>
                            <div class="bg-gray-800 rounded-lg p-3">
                                <p class="text-violet-400">\(\{3,4\}\)</p>
                                <p class="text-gray-500 text-xs mt-1">Octaedro</p>
                            </div>
                            <div class="bg-gray-800 rounded-lg p-3">
                                <p class="text-violet-400">\(\{5,3\}\)</p>
                                <p class="text-gray-500 text-xs mt-1">Dodecaedro</p>
                            </div>
                            <div class="bg-gray-800 rounded-lg p-3">
                                <p class="text-violet-400">\(\{3,5\}\)</p>
                                <p class="text-gray-500 text-xs mt-1">Icosaedro</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-900 rounded-lg p-6 mb-6">
                        <p class="text-gray-300 mb-3"><strong class="text-white">Paso 2.</strong> La figura de vertice \(\{q, r\}\) tambien debe ser un solido platonico. El valor de \(q\) queda fijado por la celda, y \(r\) debe elegirse para que \(\{q, r\}\) sea platonico.</p>
                    </div>

                    <div class="bg-gray-900 rounded-lg p-6 mb-6">
                        <p class="text-gray-300 mb-3"><strong class="text-white">Paso 3.</strong> Condicion angular. Si \(\theta_{p,q}\) es el angulo diedro del poliedro \(\{p, q\}\), entonces \(r\) celdas deben caber alrededor de cada arista:</p>
                        $$ r \cdot \theta_{p,q} < 2\pi $$
                    </div>

                    <p class="text-gray-300 mb-4">Los angulos diedros de los cinco solidos platonicos son:</p>

                    <div class="overflow-x-auto mb-6">
                        <table class="w-full text-sm text-gray-300">
                            <thead>
                                <tr class="border-b border-gray-700">
                                    <th class="px-4 py-2 text-left text-violet-400">Poliedro</th>
                                    <th class="px-4 py-2 text-center text-violet-400">Schlafli</th>
                                    <th class="px-4 py-2 text-center text-violet-400">Angulo diedro</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-800">
                                <tr><td class="px-4 py-2">Tetraedro</td><td class="px-4 py-2 text-center mono">\(\{3,3\}\)</td><td class="px-4 py-2 text-center">\(\arccos(1/3) \approx 70.53^\circ\)</td></tr>
                                <tr><td class="px-4 py-2">Cubo</td><td class="px-4 py-2 text-center mono">\(\{4,3\}\)</td><td class="px-4 py-2 text-center">\(90^\circ\)</td></tr>
                                <tr><td class="px-4 py-2">Octaedro</td><td class="px-4 py-2 text-center mono">\(\{3,4\}\)</td><td class="px-4 py-2 text-center">\(\arccos(-1/3) \approx 109.47^\circ\)</td></tr>
                                <tr><td class="px-4 py-2">Dodecaedro</td><td class="px-4 py-2 text-center mono">\(\{5,3\}\)</td><td class="px-4 py-2 text-center">\(\arctan(2) \approx 116.57^\circ\)</td></tr>
                                <tr><td class="px-4 py-2">Icosaedro</td><td class="px-4 py-2 text-center mono">\(\{3,5\}\)</td><td class="px-4 py-2 text-center">\(\approx 138.19^\circ\)</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <p class="text-gray-300 mb-4">Ahora enumeramos las combinaciones \(\{p, q, r\}\) validas. Para cada celda \(\{p,q\}\), la figura de vertice es \(\{q, r\}\). Necesitamos que \(\{q,r\}\) exista como platonico y que \(r \cdot \theta_{p,q} < 360^\circ\):</p>

                    <div class="bg-violet-500/5 border border-violet-500/20 rounded-lg p-6 space-y-3 text-gray-300">
                        <p><strong class="text-white">Celda = tetraedro \(\{3,3\}\)</strong>, \(\theta \approx 70.53^\circ\). Figura de vertice \(\{3,r\}\):</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>\(r = 3\): \(\{3,3,3\}\) -- \(3 \times 70.53^\circ = 211.6^\circ < 360^\circ\). <span class="text-green-400 font-semibold">Valido: 5-celda.</span></li>
                            <li>\(r = 4\): \(\{3,3,4\}\) -- \(4 \times 70.53^\circ = 282.1^\circ < 360^\circ\). <span class="text-green-400 font-semibold">Valido: 16-celda.</span></li>
                            <li>\(r = 5\): \(\{3,3,5\}\) -- \(5 \times 70.53^\circ = 352.6^\circ < 360^\circ\). <span class="text-green-400 font-semibold">Valido: 600-celda.</span></li>
                        </ul>

                        <p class="mt-4"><strong class="text-white">Celda = cubo \(\{4,3\}\)</strong>, \(\theta = 90^\circ\). Figura de vertice \(\{3,r\}\):</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>\(r = 3\): \(\{4,3,3\}\) -- \(3 \times 90^\circ = 270^\circ < 360^\circ\). <span class="text-green-400 font-semibold">Valido: teseracto.</span></li>
                            <li>\(r = 4\): \(4 \times 90^\circ = 360^\circ\). Teselacion plana, no convexo. <span class="text-red-400">Rechazado.</span></li>
                        </ul>

                        <p class="mt-4"><strong class="text-white">Celda = octaedro \(\{3,4\}\)</strong>, \(\theta \approx 109.47^\circ\). Figura de vertice \(\{4,r\}\):</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>\(r = 3\): \(\{3,4,3\}\) -- \(3 \times 109.47^\circ = 328.4^\circ < 360^\circ\). <span class="text-green-400 font-semibold">Valido: 24-celda.</span></li>
                        </ul>

                        <p class="mt-4"><strong class="text-white">Celda = dodecaedro \(\{5,3\}\)</strong>, \(\theta \approx 116.57^\circ\). Figura de vertice \(\{3,r\}\):</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>\(r = 3\): \(\{5,3,3\}\) -- \(3 \times 116.57^\circ = 349.7^\circ < 360^\circ\). <span class="text-green-400 font-semibold">Valido: 120-celda.</span></li>
                        </ul>

                        <p class="mt-4"><strong class="text-white">Celda = icosaedro \(\{3,5\}\)</strong>, \(\theta \approx 138.19^\circ\). Figura de vertice \(\{5,r\}\):</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>\(r = 3\): \(3 \times 138.19^\circ = 414.6^\circ > 360^\circ\). <span class="text-red-400">Rechazado. Ninguna combinacion funciona.</span></li>
                        </ul>
                    </div>

                    <p class="text-gray-300 mt-6">Resultado: exactamente <strong class="text-white">seis politopos regulares convexos</strong> en \(\mathbb{R}^4\).</p>
                </section>

                <!-- Section 3: Tabla Maestra -->
                <section class="bg-gray-950 border border-gray-800 rounded-lg p-8">
                    <h3 class="text-xl font-semibold text-violet-400 mb-4">3. Tabla Maestra de los Seis Politopos</h3>

                    <p class="text-gray-300 mb-6">La tabla siguiente resume los datos combinatorios completos. Notemos que la relacion de Euler generalizada \(V - E + F - C = 0\) se satisface en cada caso.</p>

                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-gray-300">
                            <thead>
                                <tr style="background: linear-gradient(90deg, rgba(168,85,247,0.3), rgba(139,92,246,0.15));">
                                    <th class="px-4 py-3 text-left text-white font-semibold">Politopo</th>
                                    <th class="px-4 py-3 text-center text-white font-semibold">\(\{p,q,r\}\)</th>
                                    <th class="px-4 py-3 text-center text-white font-semibold">V</th>
                                    <th class="px-4 py-3 text-center text-white font-semibold">E</th>
                                    <th class="px-4 py-3 text-center text-white font-semibold">F</th>
                                    <th class="px-4 py-3 text-center text-white font-semibold">C</th>
                                    <th class="px-4 py-3 text-left text-white font-semibold">Celdas</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-800">
                                <tr class="hover:bg-gray-900/50 transition">
                                    <td class="px-4 py-3 text-violet-300 font-medium">5-celda</td>
                                    <td class="px-4 py-3 text-center mono">\(\{3,3,3\}\)</td>
                                    <td class="px-4 py-3 text-center">5</td>
                                    <td class="px-4 py-3 text-center">10</td>
                                    <td class="px-4 py-3 text-center">10</td>
                                    <td class="px-4 py-3 text-center">5</td>
                                    <td class="px-4 py-3 text-gray-400">5 tetraedros</td>
                                </tr>
                                <tr class="hover:bg-gray-900/50 transition">
                                    <td class="px-4 py-3 text-violet-300 font-medium">Teseracto</td>
                                    <td class="px-4 py-3 text-center mono">\(\{4,3,3\}\)</td>
                                    <td class="px-4 py-3 text-center">16</td>
                                    <td class="px-4 py-3 text-center">32</td>
                                    <td class="px-4 py-3 text-center">24</td>
                                    <td class="px-4 py-3 text-center">8</td>
                                    <td class="px-4 py-3 text-gray-400">8 cubos</td>
                                </tr>
                                <tr class="hover:bg-gray-900/50 transition">
                                    <td class="px-4 py-3 text-violet-300 font-medium">16-celda</td>
                                    <td class="px-4 py-3 text-center mono">\(\{3,3,4\}\)</td>
                                    <td class="px-4 py-3 text-center">8</td>
                                    <td class="px-4 py-3 text-center">24</td>
                                    <td class="px-4 py-3 text-center">32</td>
                                    <td class="px-4 py-3 text-center">16</td>
                                    <td class="px-4 py-3 text-gray-400">16 tetraedros</td>
                                </tr>
                                <tr class="hover:bg-gray-900/50 transition">
                                    <td class="px-4 py-3 text-violet-300 font-medium">24-celda</td>
                                    <td class="px-4 py-3 text-center mono">\(\{3,4,3\}\)</td>
                                    <td class="px-4 py-3 text-center">24</td>
                                    <td class="px-4 py-3 text-center">96</td>
                                    <td class="px-4 py-3 text-center">96</td>
                                    <td class="px-4 py-3 text-center">24</td>
                                    <td class="px-4 py-3 text-gray-400">24 octaedros</td>
                                </tr>
                                <tr class="hover:bg-gray-900/50 transition">
                                    <td class="px-4 py-3 text-violet-300 font-medium">120-celda</td>
                                    <td class="px-4 py-3 text-center mono">\(\{5,3,3\}\)</td>
                                    <td class="px-4 py-3 text-center">600</td>
                                    <td class="px-4 py-3 text-center">1200</td>
                                    <td class="px-4 py-3 text-center">720</td>
                                    <td class="px-4 py-3 text-center">120</td>
                                    <td class="px-4 py-3 text-gray-400">120 dodecaedros</td>
                                </tr>
                                <tr class="hover:bg-gray-900/50 transition">
                                    <td class="px-4 py-3 text-violet-300 font-medium">600-celda</td>
                                    <td class="px-4 py-3 text-center mono">\(\{3,3,5\}\)</td>
                                    <td class="px-4 py-3 text-center">120</td>
                                    <td class="px-4 py-3 text-center">720</td>
                                    <td class="px-4 py-3 text-center">1200</td>
                                    <td class="px-4 py-3 text-center">600</td>
                                    <td class="px-4 py-3 text-gray-400">600 tetraedros</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="bg-cyan-500/5 border border-cyan-500/20 rounded-lg p-4 mt-6">
                        <p class="text-gray-300 text-sm">Verificacion rapida de Euler-Poincare para el teseracto: \(V - E + F - C = 16 - 32 + 24 - 8 = 0\). Para la 600-celda: \(120 - 720 + 1200 - 600 = 0\).</p>
                    </div>
                </section>

                <!-- Section 4: La 16-celda -->
                <section class="bg-gray-950 border border-gray-800 rounded-lg p-8">
                    <h3 class="text-xl font-semibold text-violet-400 mb-4">4. La 16-celda: El Cross-Politopo</h3>

                    <p class="text-gray-300 mb-4">La <strong class="text-white">16-celda</strong> \(\{3,3,4\}\) es el analogo 4D del octaedro. Sus 8 vertices son las permutaciones de los vectores unitarios con signo en \(\mathbb{R}^4\):</p>

                    $$ V = \{\pm e_1, \pm e_2, \pm e_3, \pm e_4\} $$

                    <p class="text-gray-300 mb-4">Explicitamente:</p>

                    <div class="bg-gray-900 rounded-lg p-4 mb-6 mono text-sm">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-center text-gray-300">
                            <span>(+1, 0, 0, 0)</span>
                            <span>(-1, 0, 0, 0)</span>
                            <span>(0, +1, 0, 0)</span>
                            <span>(0, -1, 0, 0)</span>
                            <span>(0, 0, +1, 0)</span>
                            <span>(0, 0, -1, 0)</span>
                            <span>(0, 0, 0, +1)</span>
                            <span>(0, 0, 0, -1)</span>
                        </div>
                    </div>

                    <p class="text-gray-300 mb-4">Dos vertices \(v_i\) y \(v_j\) estan conectados por una arista si y solo si son <strong class="text-white">perpendiculares</strong>:</p>

                    $$ v_i \cdot v_j = 0 $$

                    <p class="text-gray-300 mb-4">La distancia entre dos vertices adyacentes es:</p>

                    $$ \|v_i - v_j\| = \sqrt{1^2 + 1^2} = \sqrt{2} $$

                    <div class="bg-gray-900 rounded-lg p-6 mb-6">
                        <p class="text-gray-300 mb-3"><strong class="text-white">Conteo de elementos:</strong></p>
                        <ul class="list-disc list-inside space-y-2 text-gray-300 ml-2">
                            <li><strong class="text-white">Aristas (24):</strong> Cada vertice \(e_i\) es perpendicular a los 6 vertices \(\pm e_j\) con \(j \neq i\). Como cada vertice contribuye 6 aristas y cada arista conecta 2 vertices: \(E = 8 \times 6 / 2 = 24\).</li>
                            <li><strong class="text-white">Caras triangulares (32):</strong> Un triangulo se forma por tres vertices mutuamente perpendiculares, es decir, tres vectores \(\pm e_i, \pm e_j, \pm e_k\) con indices distintos. El numero de ternas de indices es \(\binom{4}{3} = 4\), y cada terna admite \(2^3 = 8\) combinaciones de signos: \(F = 4 \times 8 = 32\).</li>
                            <li><strong class="text-white">Celdas tetraedricas (16):</strong> Un tetraedro requiere 4 vertices mutuamente adyacentes, uno por cada eje. Elegimos un signo por eje: \(C = 2^4 = 16\).</li>
                        </ul>
                    </div>

                    <div class="bg-violet-500/5 border border-violet-500/20 rounded-lg p-6">
                        <p class="text-gray-300 mb-2"><strong class="text-white">Dualidad con el teseracto:</strong></p>
                        <p class="text-gray-300">La 16-celda es el <strong class="text-white">dual</strong> del teseracto. La dualidad intercambia vertices y celdas (\(V \leftrightarrow C\)) y aristas y caras (\(E \leftrightarrow F\)). El teseracto tiene \((V, E, F, C) = (16, 32, 24, 8)\) y la 16-celda tiene \((8, 24, 32, 16)\): exactamente los mismos numeros en orden invertido. Esto es analogo a la dualidad cubo \(\leftrightarrow\) octaedro en 3D.</p>
                    </div>
                </section>

                <!-- Section 5: El 24-celda -->
                <section class="bg-gray-950 border border-gray-800 rounded-lg p-8">
                    <h3 class="text-xl font-semibold text-violet-400 mb-4">5. El Misterioso 24-celda</h3>

                    <p class="text-gray-300 mb-4">El <strong class="text-white">24-celda</strong> \(\{3,4,3\}\) es el unico politopo regular 4D que <strong class="text-white">no tiene analogo en tres dimensiones</strong>. Sus 24 celdas son octaedros regulares.</p>

                    <div class="bg-violet-500/5 border border-violet-500/20 rounded-lg p-6 mb-6">
                        <p class="text-gray-300 mb-2"><strong class="text-white">Auto-dualidad.</strong> El simbolo de Schlafli \(\{3,4,3\}\) es un palindromo. Esto implica que el 24-celda es <strong class="text-white">auto-dual</strong>: su dual es un politopo congruente a si mismo. La dualidad intercambia \(V \leftrightarrow C\) y \(E \leftrightarrow F\), y en efecto \(V = C = 24\) y \(E = F = 96\).</p>
                    </div>

                    <p class="text-gray-300 mb-4">Los <strong class="text-white">24 vertices</strong> del 24-celda son todas las permutaciones de coordenadas de:</p>

                    $$ (\pm 1, \pm 1, 0, 0) $$

                    <p class="text-gray-300 mb-4">Hay \(\binom{4}{2} = 6\) formas de elegir cuales dos coordenadas son no nulas, y \(2^2 = 4\) combinaciones de signos, dando \(6 \times 4 = 24\) vertices. Cada vertice tiene norma:</p>

                    $$ \|v\| = \sqrt{1^2 + 1^2 + 0^2 + 0^2} = \sqrt{2} $$

                    <div class="bg-gray-900 rounded-lg p-6 mb-6">
                        <p class="text-gray-300 mb-3"><strong class="text-white">Estructura combinatoria:</strong></p>
                        <ul class="list-disc list-inside space-y-2 text-gray-300 ml-2">
                            <li>Cada vertice es adyacente a exactamente <strong class="text-white">8</strong> otros vertices.</li>
                            <li>Aristas: \(E = 24 \times 8 / 2 = 96\).</li>
                            <li>Tres celdas octaedricas se encuentran en cada arista (\(r = 3\)).</li>
                            <li>La figura de vertice es un cubo \(\{4,3\}\): los 8 vecinos de cada vertice forman un cubo.</li>
                        </ul>
                    </div>

                    <div class="bg-cyan-500/5 border border-cyan-500/20 rounded-lg p-6">
                        <p class="text-gray-300 mb-2"><strong class="text-white">Anticipacion: conexion con cuaterniones.</strong></p>
                        <p class="text-gray-300">Los 24 vertices del 24-celda corresponden a los <strong class="text-white">24 cuaterniones de Hurwitz</strong>, el grupo de unidades del anillo de enteros de Hurwitz en \(\mathbb{H}\). Esta conexion profunda entre el 24-celda y la aritmetica de cuaterniones sera explorada en la Leccion 23.</p>
                    </div>
                </section>

                <!-- Section 6: 120-celda y 600-celda -->
                <section class="bg-gray-950 border border-gray-800 rounded-lg p-8">
                    <h3 class="text-xl font-semibold text-violet-400 mb-4">6. 120-celda y 600-celda: Los Gigantes</h3>

                    <p class="text-gray-300 mb-4">Los dos politopos mas grandes son duales entre si y estan profundamente ligados al <strong class="text-white">numero aureo</strong> \(\varphi = (1 + \sqrt{5})/2\), del mismo modo que el icosaedro y el dodecaedro en 3D.</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-gray-900 rounded-lg p-6">
                            <h4 class="text-violet-300 font-semibold mb-3">120-celda \(\{5,3,3\}\)</h4>
                            <ul class="list-disc list-inside space-y-2 text-gray-300 text-sm">
                                <li>120 celdas dodecaedricas</li>
                                <li>600 vertices, 1200 aristas, 720 caras</li>
                                <li>4 dodecaedros en cada vertice</li>
                                <li>3 dodecaedros alrededor de cada arista</li>
                                <li>Coordenadas involucran \(\varphi, \varphi^{-1}, \varphi^2\)</li>
                            </ul>
                        </div>
                        <div class="bg-gray-900 rounded-lg p-6">
                            <h4 class="text-violet-300 font-semibold mb-3">600-celda \(\{3,3,5\}\)</h4>
                            <ul class="list-disc list-inside space-y-2 text-gray-300 text-sm">
                                <li>600 celdas tetraedricas</li>
                                <li>120 vertices, 720 aristas, 1200 caras</li>
                                <li>20 tetraedros en cada vertice</li>
                                <li>5 tetraedros alrededor de cada arista</li>
                                <li>Figura de vertice: icosaedro \(\{3,5\}\)</li>
                            </ul>
                        </div>
                    </div>

                    <p class="text-gray-300 mb-4">La dualidad se manifiesta en el intercambio:</p>

                    $$ V_{120} = C_{600} = 600, \qquad C_{120} = V_{600} = 120 $$
                    $$ E_{120} = F_{600} = 1200, \qquad F_{120} = E_{600} = 720 $$

                    <p class="text-gray-300 mb-4">Los 120 vertices de la 600-celda pueden expresarse como la union de varios conjuntos que involucran \(\varphi\). Una descripcion compacta (normalizada a radio 2) utiliza:</p>

                    <div class="bg-gray-900 rounded-lg p-6 mb-4">
                        <ul class="list-disc list-inside space-y-2 text-gray-300 text-sm">
                            <li>Las 8 permutaciones de \((\pm 2, 0, 0, 0)\)</li>
                            <li>Los 16 puntos \((\pm 1, \pm 1, \pm 1, \pm 1)\)</li>
                            <li>Las 96 permutaciones pares de \((\pm \varphi, \pm 1, \pm \varphi^{-1}, 0)\)</li>
                        </ul>
                        <p class="text-gray-400 text-sm mt-3">Total: \(8 + 16 + 96 = 120\) vertices.</p>
                    </div>

                    <p class="text-gray-300">El numero aureo \(\varphi\) aparece de manera constitutiva en estas coordenadas, reflejando la simetria icosaedrica subyacente, que es la huella inconfundible del grupo de simetria \(H_4\) de orden 14400.</p>
                </section>

                <!-- Exercises -->
                <section class="bg-gray-950 border border-gray-800 rounded-lg p-8">
                    <h3 class="text-xl font-semibold text-cyan-400 mb-6">Ejercicios</h3>

                    <div class="space-y-6">
                        <div class="bg-gray-900 rounded-lg p-5">
                            <p class="text-white font-medium mb-2">Ejercicio 1.</p>
                            <p class="text-gray-300">Verifica que los 8 vertices de la 16-celda -- \((\pm 1, 0, 0, 0)\), \((0, \pm 1, 0, 0)\), \((0, 0, \pm 1, 0)\), \((0, 0, 0, \pm 1)\) -- tienen distancias iguales entre vertices adyacentes (aquellos con producto escalar 0). Calcula explicitamente \(\|e_i - e_j\|\) para \(i \neq j\) y para \(\|e_i - (-e_j)\|\) con \(i \neq j\). Confirma que la distancia es \(\sqrt{2}\) en todos los casos.</p>
                        </div>

                        <div class="bg-gray-900 rounded-lg p-5">
                            <p class="text-white font-medium mb-2">Ejercicio 2.</p>
                            <p class="text-gray-300">Escribe explicitamente las 16 celdas tetraedricas de la 16-celda. Cada celda es un conjunto de 4 vertices mutuamente adyacentes. Muestra que se obtiene una celda eligiendo un signo (\(+\) o \(-\)) para cada uno de los 4 ejes, y que las \(2^4 = 16\) elecciones producen 16 tetraedros distintos.</p>
                        </div>

                        <div class="bg-gray-900 rounded-lg p-5">
                            <p class="text-white font-medium mb-2">Ejercicio 3.</p>
                            <p class="text-gray-300">La 5-celda (pentatopo) tiene 5 vertices. Demuestra que el numero de aristas es \(\binom{5}{2} = 10\) y el numero de caras triangulares es \(\binom{5}{3} = 10\), utilizando el hecho de que en el simplejo regular, todo subconjunto de vertices determina una cara del politopo.</p>
                        </div>

                        <div class="bg-gray-900 rounded-lg p-5">
                            <p class="text-white font-medium mb-2">Ejercicio 4.</p>
                            <p class="text-gray-300">Observa en la tabla maestra que el 24-celda satisface \(F = E = 96\) y \(V = C = 24\). Explica por que esta simetria es consecuencia directa de la auto-dualidad \(\{3,4,3\}\). Bajo la operacion de dualidad, que elementos se intercambian?</p>
                        </div>

                        <div class="bg-gray-900 rounded-lg p-5">
                            <p class="text-white font-medium mb-2">Ejercicio 5.</p>
                            <p class="text-gray-300">Identifica los tres pares duales entre los seis politopos regulares 4D. Para cada par, verifica que el numero de vertices del original coincide con el numero de celdas del dual, y viceversa. Cuales politopos son auto-duales?</p>
                        </div>
                    </div>
                </section>

                <!-- LAB -->
                <section class="bg-gray-950 border border-gray-800 rounded-lg p-8">
                    <h3 class="text-xl font-semibold text-cyan-400 mb-2">LAB: Los 6 Politopos</h3>
                    <p class="text-gray-400 mb-6">Visualizacion interactiva de los seis politopos regulares 4D proyectados a 3D. Selecciona un politopo, arrastra para rotar en 3D, y observa la rotacion automatica en el plano XW.</p>

                    <!-- Polytope Selector -->
                    <div class="flex flex-wrap gap-2 mb-4" id="polytope-selector">
                        <button data-polytope="simplex5" class="px-3 py-2 rounded-lg text-sm font-medium bg-violet-600 text-white transition hover:bg-violet-500">5-celda</button>
                        <button data-polytope="tesseract" class="px-3 py-2 rounded-lg text-sm font-medium bg-gray-800 text-gray-300 transition hover:bg-gray-700">Teseracto</button>
                        <button data-polytope="cell16" class="px-3 py-2 rounded-lg text-sm font-medium bg-gray-800 text-gray-300 transition hover:bg-gray-700">16-celda</button>
                        <button data-polytope="cell24" class="px-3 py-2 rounded-lg text-sm font-medium bg-gray-800 text-gray-300 transition hover:bg-gray-700">24-celda</button>
                        <button data-polytope="cell120" class="px-3 py-2 rounded-lg text-sm font-medium bg-gray-800 text-gray-300 transition hover:bg-gray-700">120-celda</button>
                        <button data-polytope="cell600" class="px-3 py-2 rounded-lg text-sm font-medium bg-gray-800 text-gray-300 transition hover:bg-gray-700">600-celda</button>
                    </div>

                    <!-- Info Panel -->
                    <div class="grid grid-cols-2 md:grid-cols-6 gap-3 mb-4" id="info-panel">
                        <div class="bg-gray-900 rounded-lg p-3 text-center">
                            <p class="text-xs text-gray-500">Nombre</p>
                            <p class="text-sm text-white font-medium" id="info-name">5-celda</p>
                        </div>
                        <div class="bg-gray-900 rounded-lg p-3 text-center">
                            <p class="text-xs text-gray-500">Schlafli</p>
                            <p class="text-sm text-cyan-400 mono" id="info-schlafli">{3,3,3}</p>
                        </div>
                        <div class="bg-gray-900 rounded-lg p-3 text-center">
                            <p class="text-xs text-gray-500">V</p>
                            <p class="text-sm text-white font-medium" id="info-v">5</p>
                        </div>
                        <div class="bg-gray-900 rounded-lg p-3 text-center">
                            <p class="text-xs text-gray-500">E</p>
                            <p class="text-sm text-white font-medium" id="info-e">10</p>
                        </div>
                        <div class="bg-gray-900 rounded-lg p-3 text-center">
                            <p class="text-xs text-gray-500">F</p>
                            <p class="text-sm text-white font-medium" id="info-f">10</p>
                        </div>
                        <div class="bg-gray-900 rounded-lg p-3 text-center">
                            <p class="text-xs text-gray-500">C</p>
                            <p class="text-sm text-white font-medium" id="info-c">5</p>
                        </div>
                    </div>

                    <!-- Canvas -->
                    <div class="relative rounded-lg overflow-hidden border border-gray-800" style="height: 500px;">
                        <canvas id="lab-canvas" class="w-full h-full bg-gray-950" style="display:block;"></canvas>
                    </div>
                    <p class="text-gray-600 text-xs mt-2">Arrastra con el raton para rotar en 3D. Color por profundidad en W (azul = cerca, rojo = lejos).</p>
                </section>

                <!-- Bottom Nav -->
                <div class="flex justify-between items-center pt-4">
                    <a href="./leccion-19.html" class="px-6 py-3 bg-gray-800 hover:bg-gray-700 rounded-lg font-medium text-gray-300 transition">El Salto a 4D</a>
                    <a href="./leccion-21.html" class="px-6 py-3 bg-violet-600 hover:bg-violet-500 rounded-lg font-medium text-white transition">Siguiente: Euler-Poincare y Dualidad</a>
                </div>

            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-950 border-t border-gray-800 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <p class="text-center text-gray-600 text-sm">EigenLab / Math Visual Lab / Platonic Lab -- Matematicas Visuales</p>
        </div>
    </footer>

    <!-- LAB Script -->
    <script>
    (function() {
        'use strict';

        // === POLYTOPE DATA ===
        const POLYTOPES = {
            simplex5: {
                name: '5-celda',
                schlafli: '{3,3,3}',
                V: 5, E: 10, F: 10, C: 5,
                vertices: (function() {
                    // Regular 5-cell (pentatope) in R4
                    // Vertices of regular simplex centered at origin
                    const s = 1 / Math.sqrt(10);
                    const a = s * Math.sqrt(10);
                    return [
                        [ 1,  1,  1, -1/Math.sqrt(5)],
                        [ 1, -1, -1, -1/Math.sqrt(5)],
                        [-1,  1, -1, -1/Math.sqrt(5)],
                        [-1, -1,  1, -1/Math.sqrt(5)],
                        [ 0,  0,  0,  4/Math.sqrt(5)]
                    ];
                })(),
                edges: (function() {
                    // Complete graph K5: all pairs
                    const e = [];
                    for (let i = 0; i < 5; i++)
                        for (let j = i + 1; j < 5; j++)
                            e.push([i, j]);
                    return e;
                })()
            },

            tesseract: {
                name: 'Teseracto',
                schlafli: '{4,3,3}',
                V: 16, E: 32, F: 24, C: 8,
                vertices: (function() {
                    const v = [];
                    for (let a = -1; a <= 1; a += 2)
                        for (let b = -1; b <= 1; b += 2)
                            for (let c = -1; c <= 1; c += 2)
                                for (let d = -1; d <= 1; d += 2)
                                    v.push([a, b, c, d]);
                    return v;
                })(),
                edges: (function() {
                    const v = [];
                    for (let a = -1; a <= 1; a += 2)
                        for (let b = -1; b <= 1; b += 2)
                            for (let c = -1; c <= 1; c += 2)
                                for (let d = -1; d <= 1; d += 2)
                                    v.push([a, b, c, d]);
                    const e = [];
                    for (let i = 0; i < 16; i++) {
                        for (let j = i + 1; j < 16; j++) {
                            let diff = 0;
                            for (let k = 0; k < 4; k++)
                                diff += Math.abs(v[i][k] - v[j][k]);
                            if (diff === 2) e.push([i, j]);
                        }
                    }
                    return e;
                })()
            },

            cell16: {
                name: '16-celda',
                schlafli: '{3,3,4}',
                V: 8, E: 24, F: 32, C: 16,
                vertices: [
                    [ 1, 0, 0, 0], [-1, 0, 0, 0],
                    [ 0, 1, 0, 0], [ 0,-1, 0, 0],
                    [ 0, 0, 1, 0], [ 0, 0,-1, 0],
                    [ 0, 0, 0, 1], [ 0, 0, 0,-1]
                ],
                edges: (function() {
                    const verts = [
                        [1,0,0,0],[-1,0,0,0],[0,1,0,0],[0,-1,0,0],
                        [0,0,1,0],[0,0,-1,0],[0,0,0,1],[0,0,0,-1]
                    ];
                    const e = [];
                    for (let i = 0; i < 8; i++) {
                        for (let j = i + 1; j < 8; j++) {
                            let dot = 0;
                            for (let k = 0; k < 4; k++)
                                dot += verts[i][k] * verts[j][k];
                            if (Math.abs(dot) < 0.001) e.push([i, j]);
                        }
                    }
                    return e;
                })()
            },

            cell24: {
                name: '24-celda',
                schlafli: '{3,4,3}',
                V: 24, E: 96, F: 96, C: 24,
                vertices: (function() {
                    const v = [];
                    // All permutations of (+-1, +-1, 0, 0)
                    for (let i = 0; i < 4; i++) {
                        for (let j = i + 1; j < 4; j++) {
                            for (let si = -1; si <= 1; si += 2) {
                                for (let sj = -1; sj <= 1; sj += 2) {
                                    const p = [0, 0, 0, 0];
                                    p[i] = si;
                                    p[j] = sj;
                                    v.push(p);
                                }
                            }
                        }
                    }
                    return v;
                })(),
                edges: (function() {
                    const verts = [];
                    for (let i = 0; i < 4; i++) {
                        for (let j = i + 1; j < 4; j++) {
                            for (let si = -1; si <= 1; si += 2) {
                                for (let sj = -1; sj <= 1; sj += 2) {
                                    const p = [0, 0, 0, 0];
                                    p[i] = si;
                                    p[j] = sj;
                                    verts.push(p);
                                }
                            }
                        }
                    }
                    const e = [];
                    // Edge if distance^2 = 2 (adjacent in 24-cell with these coords)
                    for (let i = 0; i < 24; i++) {
                        for (let j = i + 1; j < 24; j++) {
                            let d2 = 0;
                            for (let k = 0; k < 4; k++)
                                d2 += (verts[i][k] - verts[j][k]) ** 2;
                            if (Math.abs(d2 - 2) < 0.001) e.push([i, j]);
                        }
                    }
                    return e;
                })()
            },

            cell120: {
                name: '120-celda',
                schlafli: '{5,3,3}',
                V: 600, E: 1200, F: 720, C: 120,
                vertices: null, // Too complex, generated below
                edges: null,
                complex: true
            },

            cell600: {
                name: '600-celda',
                schlafli: '{3,3,5}',
                V: 120, E: 720, F: 1200, C: 600,
                vertices: null,
                edges: null,
                complex: false // We can compute the 120 vertices
            }
        };

        // Generate 600-cell vertices
        (function() {
            const phi = (1 + Math.sqrt(5)) / 2;
            const iphi = 1 / phi; // phi^{-1} = phi - 1
            const verts = [];

            // 8 vertices: permutations of (+-2, 0, 0, 0)
            for (let i = 0; i < 4; i++) {
                for (let s = -1; s <= 1; s += 2) {
                    const v = [0, 0, 0, 0];
                    v[i] = 2 * s;
                    verts.push(v);
                }
            }

            // 16 vertices: (+-1, +-1, +-1, +-1)
            for (let a = -1; a <= 1; a += 2)
                for (let b = -1; b <= 1; b += 2)
                    for (let c = -1; c <= 1; c += 2)
                        for (let d = -1; d <= 1; d += 2)
                            verts.push([a, b, c, d]);

            // 96 vertices: even permutations of (+-phi, +-1, +-iphi, 0)
            const base = [phi, 1, iphi, 0];
            // Even permutations of 4 elements (12 permutations)
            const evenPerms = [
                [0,1,2,3],[0,2,3,1],[0,3,1,2],
                [1,0,3,2],[1,2,0,3],[1,3,2,0],
                [2,0,1,3],[2,1,3,0],[2,3,0,1],
                [3,0,2,1],[3,1,0,2],[3,2,1,0]
            ];

            for (const perm of evenPerms) {
                const vals = [base[perm[0]], base[perm[1]], base[perm[2]], base[perm[3]]];
                // All sign combinations for non-zero entries
                const nonzero = [];
                for (let k = 0; k < 4; k++) {
                    if (Math.abs(vals[k]) > 0.001) nonzero.push(k);
                }
                const signCount = nonzero.length;
                for (let s = 0; s < (1 << signCount); s++) {
                    const v = [...vals];
                    for (let b = 0; b < signCount; b++) {
                        if (s & (1 << b)) v[nonzero[b]] = -v[nonzero[b]];
                    }
                    // Check for duplicates
                    let dup = false;
                    for (const existing of verts) {
                        let match = true;
                        for (let k = 0; k < 4; k++) {
                            if (Math.abs(existing[k] - v[k]) > 0.001) { match = false; break; }
                        }
                        if (match) { dup = true; break; }
                    }
                    if (!dup) verts.push(v);
                }
            }

            // Normalize to radius ~1.5 for visual consistency
            const scale = 1.5 / 2;
            for (let i = 0; i < verts.length; i++) {
                for (let k = 0; k < 4; k++) verts[i][k] *= scale;
            }

            POLYTOPES.cell600.vertices = verts;

            // Compute edges: connected if distance = 2*scale * (1/phi)
            // In unscaled coords, edge length of 600-cell at radius 2 is 2/phi
            const edgeLen2 = (2 * scale / phi) ** 2;
            const edges = [];
            for (let i = 0; i < verts.length; i++) {
                for (let j = i + 1; j < verts.length; j++) {
                    let d2 = 0;
                    for (let k = 0; k < 4; k++)
                        d2 += (verts[i][k] - verts[j][k]) ** 2;
                    if (Math.abs(d2 - edgeLen2) < 0.01) edges.push([i, j]);
                }
            }
            POLYTOPES.cell600.edges = edges;
        })();

        // 120-cell: use dual of 600-cell (vertices at cell centers)
        // For simplicity, show a message or use a subset
        (function() {
            // Generate 120-cell as reciprocal/dual of 600-cell
            // Each cell of 600-cell is a tetrahedron; the center of each tetrahedron
            // becomes a vertex of the 120-cell. This is complex.
            // Instead, show just the 600-cell vertices as points for 120-cell preview.
            POLYTOPES.cell120.vertices = null;
            POLYTOPES.cell120.edges = null;
            POLYTOPES.cell120.complex = true;
        })();

        // === CANVAS SETUP ===
        const canvas = document.getElementById('lab-canvas');
        const ctx = canvas.getContext('2d');
        let W, H;

        function resizeCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            W = rect.width;
            H = rect.height;
            canvas.width = W * dpr;
            canvas.height = H * dpr;
            canvas.style.width = W + 'px';
            canvas.style.height = H + 'px';
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // === STATE ===
        let currentPolytope = 'simplex5';
        let angleXW = 0; // 4D rotation angle in XW plane
        let rotX3D = 0.3; // 3D rotation
        let rotY3D = 0.5;
        let isDragging = false;
        let lastMouseX = 0, lastMouseY = 0;
        const viewDist4D = 3.0; // perspective distance for 4D->3D
        const viewDist3D = 5.0; // perspective distance for 3D->2D

        // === PROJECTION ===
        function rotateXW(v, angle) {
            const c = Math.cos(angle), s = Math.sin(angle);
            return [
                v[0] * c - v[3] * s,
                v[1],
                v[2],
                v[0] * s + v[3] * c
            ];
        }

        function rotateYW(v, angle) {
            const c = Math.cos(angle), s = Math.sin(angle);
            return [
                v[0],
                v[1] * c - v[3] * s,
                v[2],
                v[1] * s + v[3] * c
            ];
        }

        function project4Dto3D(v4, d) {
            const w = v4[3];
            const scale = d / (w + d);
            return [v4[0] * scale, v4[1] * scale, v4[2] * scale, w];
        }

        function rotateY3(v, angle) {
            const c = Math.cos(angle), s = Math.sin(angle);
            return [v[0] * c + v[2] * s, v[1], -v[0] * s + v[2] * c, v[3]];
        }

        function rotateX3(v, angle) {
            const c = Math.cos(angle), s = Math.sin(angle);
            return [v[0], v[1] * c - v[2] * s, v[1] * s + v[2] * c, v[3]];
        }

        function project3Dto2D(v3, d) {
            const scale = d / (v3[2] + d);
            return [v3[0] * scale, v3[1] * scale, v3[2], v3[3]];
        }

        // === COLOR BY DEPTH ===
        function depthColor(w, minW, maxW) {
            if (maxW === minW) return 'rgba(168, 130, 255, 0.9)';
            const t = (w - minW) / (maxW - minW); // 0 = min w, 1 = max w
            // blue (near, low w) -> red (far, high w)
            const r = Math.floor(50 + 200 * t);
            const g = Math.floor(50 + 80 * (1 - Math.abs(t - 0.5) * 2));
            const b = Math.floor(50 + 200 * (1 - t));
            return `rgb(${r}, ${g}, ${b})`;
        }

        function depthAlpha(w, minW, maxW) {
            if (maxW === minW) return 0.8;
            const t = (w - minW) / (maxW - minW);
            return 0.3 + 0.6 * (1 - t); // nearer = more opaque
        }

        // === DRAW ===
        function draw() {
            ctx.clearRect(0, 0, W, H);
            ctx.fillStyle = '#030712';
            ctx.fillRect(0, 0, W, H);

            const poly = POLYTOPES[currentPolytope];

            if (poly.complex && !poly.vertices) {
                // Show message for 120-cell
                ctx.fillStyle = '#6b7280';
                ctx.font = '16px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Estructura demasiado compleja para visualizacion interactiva.', W / 2, H / 2 - 20);
                ctx.fillText('El 120-celda tiene 600 vertices y 1200 aristas.', W / 2, H / 2 + 10);
                ctx.fillText('Selecciona otro politopo para explorar.', W / 2, H / 2 + 40);
                return;
            }

            const verts = poly.vertices;
            const edges = poly.edges;
            if (!verts || !edges) return;

            const cx = W / 2, cy = H / 2;
            const scaleFactor = Math.min(W, H) * 0.28;

            // Project all vertices
            const projected = [];
            let minW = Infinity, maxW = -Infinity;

            for (const v of verts) {
                // 4D rotation in XW plane
                let r = rotateXW(v, angleXW);
                // Also a slow YW rotation for variety
                r = rotateYW(r, angleXW * 0.37);

                // Project 4D -> 3D
                const p3 = project4Dto3D(r, viewDist4D);

                // 3D rotation (mouse-controlled)
                let r3 = rotateY3(p3, rotY3D);
                r3 = rotateX3(r3, rotX3D);

                // Project 3D -> 2D
                const p2 = project3Dto2D(r3, viewDist3D);

                const sx = cx + p2[0] * scaleFactor;
                const sy = cy - p2[1] * scaleFactor;

                minW = Math.min(minW, r[3]);
                maxW = Math.max(maxW, r[3]);

                projected.push({ x: sx, y: sy, w: r[3], z3: r3[2] });
            }

            // Draw edges
            for (const [i, j] of edges) {
                const a = projected[i], b = projected[j];
                const avgW = (a.w + b.w) / 2;
                const alpha = depthAlpha(avgW, minW, maxW) * 0.6;
                ctx.beginPath();
                ctx.moveTo(a.x, a.y);
                ctx.lineTo(b.x, b.y);
                ctx.strokeStyle = depthColor(avgW, minW, maxW);
                ctx.globalAlpha = alpha;
                ctx.lineWidth = 1.2;
                ctx.stroke();
            }

            ctx.globalAlpha = 1;

            // Draw vertices sorted by z3 (painter's algorithm)
            const sortedIndices = projected.map((p, i) => i).sort((a, b) => projected[a].z3 - projected[b].z3);

            for (const i of sortedIndices) {
                const p = projected[i];
                const radius = 2.5 + 2 * depthAlpha(p.w, minW, maxW);
                ctx.beginPath();
                ctx.arc(p.x, p.y, radius, 0, Math.PI * 2);
                ctx.fillStyle = depthColor(p.w, minW, maxW);
                ctx.globalAlpha = depthAlpha(p.w, minW, maxW);
                ctx.fill();
            }
            ctx.globalAlpha = 1;
        }

        // === ANIMATION ===
        let lastTime = 0;
        function animate(time) {
            const dt = (time - lastTime) / 1000;
            lastTime = time;

            angleXW += dt * 0.4;

            draw();
            requestAnimationFrame(animate);
        }
        requestAnimationFrame(animate);

        // === MOUSE INTERACTION ===
        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const dx = e.clientX - lastMouseX;
            const dy = e.clientY - lastMouseY;
            rotY3D += dx * 0.008;
            rotX3D += dy * 0.008;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
        });

        canvas.addEventListener('mouseup', () => isDragging = false);
        canvas.addEventListener('mouseleave', () => isDragging = false);

        // Touch support
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            isDragging = true;
            lastMouseX = e.touches[0].clientX;
            lastMouseY = e.touches[0].clientY;
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!isDragging) return;
            const dx = e.touches[0].clientX - lastMouseX;
            const dy = e.touches[0].clientY - lastMouseY;
            rotY3D += dx * 0.008;
            rotX3D += dy * 0.008;
            lastMouseX = e.touches[0].clientX;
            lastMouseY = e.touches[0].clientY;
        }, { passive: false });

        canvas.addEventListener('touchend', () => isDragging = false);

        // === POLYTOPE SELECTOR ===
        const buttons = document.querySelectorAll('#polytope-selector button');
        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                const key = btn.dataset.polytope;
                currentPolytope = key;

                // Update button styles
                buttons.forEach(b => {
                    b.className = 'px-3 py-2 rounded-lg text-sm font-medium bg-gray-800 text-gray-300 transition hover:bg-gray-700';
                });
                btn.className = 'px-3 py-2 rounded-lg text-sm font-medium bg-violet-600 text-white transition hover:bg-violet-500';

                // Update info panel
                const poly = POLYTOPES[key];
                document.getElementById('info-name').textContent = poly.name;
                document.getElementById('info-schlafli').textContent = poly.schlafli;
                document.getElementById('info-v').textContent = poly.V;
                document.getElementById('info-e').textContent = poly.E;
                document.getElementById('info-f').textContent = poly.F;
                document.getElementById('info-c').textContent = poly.C;
            });
        });

    })();
    </script>

</body>
</html>