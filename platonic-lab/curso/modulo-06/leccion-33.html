<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leccion 33: Quasicristales y el Gran Final | Matematicas Visuales</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '\\(', right: '\\)', display: false}]});"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glow-text { text-shadow: 0 0 20px rgba(168, 85, 247, 0.5); }
        .progress-bar { background: linear-gradient(90deg, #a855f7, #22d3ee); }
        .katex { color: inherit; font-size: 1.1em; }
    </style>
</head>
<body class="bg-black text-gray-100 min-h-screen">
    <!-- Header -->
    <header class="border-b border-gray-900 bg-black/80 backdrop-blur-sm sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <nav class="text-xs text-gray-600 mb-1">
                        <a href="../../../../../_portal/index.html" class="hover:text-violet-400 transition">EigenLab</a>
                        <span class="mx-1">/</span>
                        <a href="../../../index.html" class="hover:text-violet-400 transition">Math Visual Lab</a>
                        <span class="mx-1">/</span>
                        <a href="../../index.html" class="hover:text-violet-400 transition">Platonic Lab</a>
                        <span class="mx-1">/</span>
                        <a href="../index.html" class="hover:text-violet-400 transition">Curso</a>
                        <span class="mx-1">/</span>
                        <span class="text-gray-500">Modulo 06</span>
                    </nav>
                    <h1 class="text-lg font-light">
                        <span class="text-violet-400 font-medium glow-text">Leccion 33</span> — Quasicristales y el Gran Final
                    </h1>
                </div>
                <nav class="flex gap-2 text-sm">
                    <a href="./leccion-32.html" class="px-3 py-2 rounded-lg hover:bg-gray-900 text-gray-400 transition">&larr; Anterior</a>
                    <a href="../index.html" class="px-3 py-2 rounded-lg bg-violet-500/10 text-violet-400 hover:bg-violet-500/20 transition">Volver al Curso &rarr;</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="max-w-6xl mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Sidebar -->
            <aside class="lg:col-span-1">
                <div class="bg-gray-950 border border-gray-900 rounded-2xl p-6 sticky top-24">
                    <h3 class="text-lg font-semibold mb-4 text-cyan-400">Modulo 06</h3>
                    <p class="text-sm text-gray-500 mb-4">Aplicaciones Modernas</p>

                    <div class="mb-6">
                        <div class="flex justify-between text-xs text-gray-400 mb-2">
                            <span>Progreso</span>
                            <span>4/4</span>
                        </div>
                        <div class="w-full bg-gray-800 rounded-full h-2">
                            <div class="progress-bar h-2 rounded-full" style="width: 100%"></div>
                        </div>
                    </div>

                    <div class="mb-4 p-3 bg-violet-500/10 border border-violet-500/30 rounded-lg">
                        <p class="text-violet-400 text-sm font-semibold text-center">Curso completado</p>
                        <p class="text-violet-300/70 text-xs text-center mt-1">33 lecciones</p>
                    </div>

                    <nav class="space-y-2">
                        <a href="./leccion-30.html" class="block px-3 py-2 rounded-lg hover:bg-gray-900 text-gray-400 text-sm transition">30. Cristales y Redes de Bravais</a>
                        <a href="./leccion-31.html" class="block px-3 py-2 rounded-lg hover:bg-gray-900 text-gray-400 text-sm transition">31. Virus Icosaedricos</a>
                        <a href="./leccion-32.html" class="block px-3 py-2 rounded-lg hover:bg-gray-900 text-gray-400 text-sm transition">32. Fullerenos y Nanotubos</a>
                        <a href="./leccion-33.html" class="block px-3 py-2 rounded-lg bg-violet-500/10 text-violet-400 text-sm">33. Quasicristales y el Gran Final</a>
                    </nav>
                </div>
            </aside>

            <!-- Content -->
            <main class="lg:col-span-3">
                <article class="bg-gray-950 border border-gray-900 rounded-2xl p-8">
                    <div class="mb-8">
                        <span class="text-cyan-400 text-sm font-medium">Leccion 33 -- Fin del Curso</span>
                        <h2 class="text-3xl font-light mt-2 mb-4">
                            <span class="text-violet-400 font-medium glow-text">Quasicristales</span> y el Gran Final
                        </h2>
                        <p class="text-gray-400 text-lg">La simetria prohibida, la teselacion aperiodica, y el hilo dorado que conecta 2400 anios de geometria.</p>
                    </div>

                    <!-- 1. La Simetria Prohibida -->
                    <section class="mb-10">
                        <h3 class="text-xl font-semibold text-violet-400 mb-4">1. La Simetria Prohibida</h3>
                        <p class="text-gray-300 mb-4">
                            El 8 de abril de 1982, Dan Shechtman observa al microscopio electronico un patron de difraccion que no deberia existir. Una aleacion de aluminio y manganeso, enfriada rapidamente, produce puntos de difraccion nitidos --indicando orden-- dispuestos con <strong class="text-white">simetria rotacional de orden 10</strong>. Shechtman anota en su cuaderno: "10 fold ???". Sabe que lo que ve contradice un siglo y medio de cristalografia.
                        </p>
                        <p class="text-gray-300 mb-4">
                            El <strong class="text-white">teorema de restriccion cristalografica</strong>, que estudiamos en la Leccion 30, establece que una rotacion que preserve una red periodica en \(\mathbb{R}^2\) o \(\mathbb{R}^3\) debe satisfacer que su traza sea un entero. Para una rotacion de angulo \(2\pi/n\), esto exige:
                        </p>

                        $$ \cos\!\left(\frac{2\pi}{n}\right) \in \left\{0, \pm\tfrac{1}{2}, \pm 1\right\} \implies n \in \{1, 2, 3, 4, 6\} $$

                        <p class="text-gray-300 mb-4">
                            Ningun cristal periodico puede tener simetria de orden 5, 7, 8, 10, ni ningun otro \(n\) fuera de ese conjunto. El icosaedro, con su simetria de orden 5 y grupo \(I_h\) de 120 elementos (Leccion 15), <strong class="text-white">no es un grupo cristalografico</strong>. La comunidad cientifica considera esto un hecho indiscutible.
                        </p>
                        <p class="text-gray-300 mb-4">
                            Shechtman presenta sus resultados. La reaccion es hostil. Linus Pauling, dos veces Nobel, declara: "No existen los quasicristales, solo los quasi-cientificos." Le piden que abandone su grupo de investigacion. Pero Shechtman no cede. Repite el experimento. Publica en 1984. Otros laboratorios confirman. Y en 2011, Dan Shechtman recibe el Premio Nobel de Quimica.
                        </p>

                        <div class="bg-gray-900 border border-gray-800 rounded-xl p-6 mb-4">
                            <p class="text-gray-300 mb-2"><strong class="text-cyan-400">La resolucion de la paradoja</strong></p>
                            <p class="text-gray-300">
                                Los quasicristales son <strong class="text-white">ordenados</strong> (producen puntos de difraccion nitidos, como un cristal) pero <strong class="text-white">no periodicos</strong> (ninguna traslacion los transforma en si mismos). La restriccion cristalografica solo prohíbe la simetria 5 en estructuras <em>periodicas</em>. Shechtman descubrio un tercer estado de la materia: ni amorfo ni periodico, sino <strong class="text-white">quasiperiodico</strong>.
                            </p>
                        </div>
                    </section>

                    <!-- 2. Teselaciones de Penrose -->
                    <section class="mb-10">
                        <h3 class="text-xl font-semibold text-violet-400 mb-4">2. Teselaciones de Penrose</h3>
                        <p class="text-gray-300 mb-4">
                            La base matematica de los quasicristales fue desarrollada <em>antes</em> del descubrimiento de Shechtman. En 1974, Roger Penrose demostro que es posible cubrir el plano completo con solo dos tipos de pieza, de manera que el resultado sea <strong class="text-white">aperiodico</strong>: nunca se repite por traslacion, pero posee orden a larga distancia.
                        </p>
                        <p class="text-gray-300 mb-4">
                            Las dos piezas fundamentales son los <strong class="text-white">rombos gordo y flaco</strong> (fat and thin rhombuses). El rombo gordo tiene angulos internos de \(2\pi/5\) y \(3\pi/5\); el flaco, de \(\pi/5\) y \(4\pi/5\). Todos los angulos son multiplos de \(\pi/5\), vinculandolos directamente al pentagono regular.
                        </p>
                        <p class="text-gray-300 mb-4">
                            Propiedades de la teselacion de Penrose:
                        </p>
                        <ul class="list-disc list-inside text-gray-300 mb-4 space-y-2">
                            <li>Cubre el plano entero sin huecos ni superposiciones.</li>
                            <li>No es periodica: ninguna traslacion no trivial la transforma en si misma.</li>
                            <li>Tiene <strong class="text-white">simetria rotacional de orden 5</strong> localmente y en su patron de difraccion.</li>
                            <li>Es <strong class="text-white">auto-similar</strong>: aplicando reglas de inflacion-deflacion, cada pieza se descompone en piezas mas pequenias del mismo tipo.</li>
                        </ul>
                        <p class="text-gray-300 mb-4">
                            Y aqui aparece el protagonista inesperado: el <strong class="text-white">numero aureo</strong> \(\phi\). La razon entre el numero de rombos gordos y flacos en una teselacion de Penrose converge a:
                        </p>

                        $$ \phi = \frac{1 + \sqrt{5}}{2} \approx 1.618033\ldots $$

                        <p class="text-gray-300 mb-4">
                            El factor de escala de la auto-similitud es \(\phi\). Las frecuencias relativas de los dos tipos de pieza estan en razon \(\phi : 1\). Los vertices de las piezas caen sobre una red quasiperiodica gobernada por \(\phi\).
                        </p>
                        <p class="text-gray-300 mb-4">
                            Recordemos del Modulo 1: la diagonal de un pentagono regular de lado 1 mide exactamente \(\phi\). El icosaedro contiene tres rectangulos aureos mutuamente perpendiculares. Ahora esas mismas proporciones aparecen en la estructura misma de la materia.
                        </p>

                        <!-- Canvas: Penrose Tiling Illustration -->
                        <div class="my-6">
                            <canvas id="penrose-canvas" class="w-full rounded-xl" style="height: 380px;"></canvas>
                            <p class="text-center text-gray-500 text-sm mt-2">Teselacion de Penrose: rombos gordos (cyan) y flacos (violeta) con simetria de orden 5</p>
                        </div>
                    </section>

                    <!-- 3. Proyeccion desde Dimensiones Superiores -->
                    <section class="mb-10">
                        <h3 class="text-xl font-semibold text-violet-400 mb-4">3. Proyeccion desde Dimensiones Superiores</h3>
                        <p class="text-gray-300 mb-4">
                            La explicacion mas profunda de las teselaciones aperiodicas proviene de la geometria de dimensiones superiores. Una teselacion de Penrose en 2D puede obtenerse como la <strong class="text-white">proyeccion</strong> de una red cristalina periodica en 5 dimensiones.
                        </p>
                        <p class="text-gray-300 mb-4">
                            El metodo de <strong class="text-white">corte y proyeccion</strong> (cut and project) funciona asi:
                        </p>
                        <ul class="list-disc list-inside text-gray-300 mb-4 space-y-2">
                            <li>Consideramos la red entera \(\mathbb{Z}^5\), el conjunto de todos los puntos con coordenadas enteras en 5 dimensiones.</li>
                            <li>Elegimos un subespacio 2D \(E_\parallel\) (el "espacio fisico") cuya orientacion respecto a los ejes tiene una pendiente <em>irracional</em> determinada por \(\phi\).</li>
                            <li>Definimos una franja \(\mathcal{S}\) alrededor de \(E_\parallel\) (una "ventana de aceptacion" en el espacio complementario \(E_\perp\)).</li>
                            <li>Proyectamos sobre \(E_\parallel\) todos los puntos de \(\mathbb{Z}^5\) que caen dentro de la franja.</li>
                        </ul>

                        $$ \text{Penrose tiling} = \pi_\parallel \!\left( \mathbb{Z}^5 \cap \mathcal{S} \right) $$

                        <p class="text-gray-300 mb-4">
                            donde \(\pi_\parallel\) es la proyeccion ortogonal sobre \(E_\parallel\). La irracionalidad de la pendiente (ligada a \(\phi\)) garantiza que el patron resultante nunca sea periodico: la franja nunca corta la red de manera que se repita exactamente.
                        </p>
                        <p class="text-gray-300 mb-4">
                            Para quasicristales 3D con <strong class="text-white">simetria icosaedrica</strong>, el procedimiento analogo utiliza una red cubica en <strong class="text-white">6 dimensiones</strong>. El espacio fisico \(E_\parallel\) es un subespacio 3D de \(\mathbb{R}^6\), y la simetria icosaedrica emerge naturalmente de la simetria cubica en 6D.
                        </p>

                        <div class="bg-gray-900 border border-gray-800 rounded-xl p-6">
                            <p class="text-gray-300 mb-2"><strong class="text-cyan-400">Conexion con el Modulo 4</strong></p>
                            <p class="text-gray-300">
                                En el Modulo 4 estudiamos los politopos regulares en dimensiones superiores: el teseracto en 4D, el 120-cell y el 600-cell, los diagramas de Schlegel. Ahora esas dimensiones superiores no son solo abstracciones: los quasicristales son literalmente <strong class="text-white">sombras de estructuras periodicas de dimensiones superiores</strong> proyectadas sobre nuestro espacio tridimensional. La cuarta dimension y mas alla tienen consecuencias fisicas reales.
                            </p>
                        </div>
                    </section>

                    <!-- 4. Quasicristales Reales -->
                    <section class="mb-10">
                        <h3 class="text-xl font-semibold text-violet-400 mb-4">4. Quasicristales Reales</h3>
                        <p class="text-gray-300 mb-4">
                            Desde el descubrimiento de Shechtman, se han sintetizado centenares de quasicristales. Algunos son metaestables; otros son perfectamente estables y pueden crecer como monocristales de gran tamanio.
                        </p>

                        <div class="overflow-x-auto mb-6">
                            <table class="w-full text-sm text-gray-300">
                                <thead>
                                    <tr class="border-b border-gray-800">
                                        <th class="px-4 py-3 text-left text-gray-400 font-medium">Material</th>
                                        <th class="px-4 py-3 text-center text-gray-400 font-medium">Anio</th>
                                        <th class="px-4 py-3 text-center text-gray-400 font-medium">Simetria</th>
                                        <th class="px-4 py-3 text-left text-gray-400 font-medium">Notas</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b border-gray-900">
                                        <td class="px-4 py-2 mono text-sm">Al-Mn</td>
                                        <td class="px-4 py-2 text-center">1982</td>
                                        <td class="px-4 py-2 text-center text-violet-400">Icosaedrica</td>
                                        <td class="px-4 py-2 text-sm">Descubrimiento original de Shechtman; metaestable</td>
                                    </tr>
                                    <tr class="border-b border-gray-900">
                                        <td class="px-4 py-2 mono text-sm">Al-Cu-Fe</td>
                                        <td class="px-4 py-2 text-center">1987</td>
                                        <td class="px-4 py-2 text-center text-violet-400">Icosaedrica</td>
                                        <td class="px-4 py-2 text-sm">Termodinamicamente estable; recubrimientos antiadherentes</td>
                                    </tr>
                                    <tr class="border-b border-gray-900">
                                        <td class="px-4 py-2 mono text-sm">Al-Pd-Mn</td>
                                        <td class="px-4 py-2 text-center">1990</td>
                                        <td class="px-4 py-2 text-center text-violet-400">Icosaedrica</td>
                                        <td class="px-4 py-2 text-sm">Monocristales de alta calidad; superficie perfecta</td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2 mono text-sm">Icosahedrita</td>
                                        <td class="px-4 py-2 text-center">2009</td>
                                        <td class="px-4 py-2 text-center text-cyan-400">Icosaedrica</td>
                                        <td class="px-4 py-2 text-sm">Al&#8326;&#8323;Cu&#8322;&#8324;Fe&#8321;&#8323;; natural, meteorito Khatyrka (Kamchatka)</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <p class="text-gray-300 mb-4">
                            El descubrimiento de la icosahedrita en 2009 --un quasicristal <em>natural</em> encontrado en un meteorito del rio Khatyrka en Kamchatka-- demostro que la naturaleza ya habia producido quasicristales miles de millones de anios antes de que los humanos aprendieran a sintetizarlos. Las condiciones extremas de un impacto meteoritico proporcionaron el enfriamiento rapido necesario.
                        </p>
                        <p class="text-gray-300 mb-4">
                            Las propiedades fisicas de los quasicristales son tan inusuales como su estructura:
                        </p>
                        <ul class="list-disc list-inside text-gray-300 mb-4 space-y-2">
                            <li><strong class="text-white">Bajo coeficiente de friccion</strong>: superficies quasicristalinas son mas resbaladizas que el teflon.</li>
                            <li><strong class="text-white">Baja conductividad termica</strong>: a pesar de ser metalicos, conducen el calor peor que muchos ceramicos.</li>
                            <li><strong class="text-white">Alta dureza</strong>: pero fragiles, sin la ductilidad de los metales convencionales.</li>
                            <li><strong class="text-white">Propiedades opticas</strong>: interaccion inusual con la luz, potencial en materiales fotonicos.</li>
                        </ul>

                        <!-- Canvas: Diffraction Pattern -->
                        <div class="my-6">
                            <canvas id="diffraction-canvas" class="w-full rounded-xl" style="height: 380px;"></canvas>
                            <p class="text-center text-gray-500 text-sm mt-2">Patron de difraccion con simetria 10-fold: el patron que Shechtman vio en 1982</p>
                        </div>
                    </section>

                    <!-- 5. El Numero Aureo como Hilo Conductor -->
                    <section class="mb-10">
                        <h3 class="text-xl font-semibold text-violet-400 mb-4">5. El Numero Aureo como Hilo Conductor</h3>
                        <p class="text-gray-300 mb-4">
                            El numero \(\phi = (1 + \sqrt{5})/2\) ha aparecido en cada uno de los seis modulos del curso. No como coincidencia, sino como <strong class="text-white">principio estructural</strong> que conecta la geometria clasica con la fisica moderna.
                        </p>

                        $$ \phi^2 = \phi + 1, \qquad \frac{1}{\phi} = \phi - 1 $$

                        <div class="space-y-4 mb-6">
                            <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
                                <p class="text-gray-300"><strong class="text-cyan-400">Modulo 1 -- Solidos Platonicos.</strong> La diagonal de un pentagono regular de lado 1 mide \(\phi\). Los vertices del icosaedro se construyen a partir de tres rectangulos aureos mutuamente perpendiculares, con coordenadas \((0, \pm 1, \pm \phi)\) y permutaciones ciclicas.</p>
                            </div>
                            <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
                                <p class="text-gray-300"><strong class="text-cyan-400">Modulo 2 -- Mas Alla de Platon.</strong> El icosaedro truncado (balon de futbol, C&#8326;&#8320;) hereda la simetria de \(I_h\). Sus coordenadas contienen \(\phi\) y \(\phi^2\). Los solidos de Kepler-Poinsot, con sus caras y vertices penetrantes, codifican \(\phi\) en sus proporciones.</p>
                            </div>
                            <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
                                <p class="text-gray-300"><strong class="text-cyan-400">Modulo 3 -- Simetria y Algebra.</strong> Las matrices de rotacion del grupo \(I_h\) contienen entradas que involucran \(\cos(2\pi/5) = (\phi - 1)/2\) y \(\cos(4\pi/5) = -\phi/2\). El numero aureo esta codificado en la tabla de caracteres de \(I_h\).</p>
                            </div>
                            <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
                                <p class="text-gray-300"><strong class="text-cyan-400">Modulo 4 -- La Cuarta Dimension.</strong> El 600-cell, politopo regular en 4D con 120 vertices, tiene coordenadas que usan \(\phi\) y \(1/\phi\). El grupo de simetria del 120-cell tiene 14400 elementos, y \(\phi\) gobierna sus proporciones internas.</p>
                            </div>
                            <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
                                <p class="text-gray-300"><strong class="text-cyan-400">Modulo 5 -- Teoria de Grafos.</strong> La conectividad algebraica del dodecaedro (el segundo autovalor del Laplaciano) es \(\lambda_2 = 3 - \sqrt{5} = 2(1 - 1/\phi)\). Los autovalores de la matriz de adyacencia del icosaedro son \(\pm 1, \pm \sqrt{5}\), directamente ligados a \(\phi\).</p>
                            </div>
                            <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
                                <p class="text-gray-300"><strong class="text-cyan-400">Modulo 6 -- Aplicaciones Modernas.</strong> La teselacion de Penrose esta gobernada por \(\phi\): la razon de frecuencias de los dos tipos de pieza, el factor de auto-similitud, los angulos de los rombos. Los quasicristales reales realizan \(\phi\) en la estructura atomica de la materia.</p>
                            </div>
                        </div>

                        <p class="text-gray-300">
                            El numero aureo no es una curiosidad numerica. Es un principio organizador que se manifiesta desde la geometria abstracta de dimensiones superiores hasta los patrones de difraccion de aleaciones metalicas. Donde hay simetria pentagonal, hay \(\phi\).
                        </p>
                    </section>

                    <!-- 6. El Gran Arco: De Platon a los Quasicristales -->
                    <section class="mb-10">
                        <h3 class="text-xl font-semibold text-violet-400 mb-4">6. El Gran Arco: De Platon a los Quasicristales</h3>
                        <p class="text-gray-300 mb-4">
                            Contemplemos el arco completo del curso: 33 lecciones, 6 modulos, 2400 anios de pensamiento matematico comprimidos en una sola trayectoria.
                        </p>

                        <div class="space-y-4 mb-6">
                            <div class="border-l-2 border-violet-500/50 pl-4">
                                <p class="text-white font-medium mb-1">Modulo 1 -- Los Solidos Platonicos (L1-L8)</p>
                                <p class="text-gray-400 text-sm">Comenzamos donde comenzo la geometria: con cinco formas perfectas. Demostramos que solo pueden existir cinco poliedros regulares convexos. La formula de Euler \(V - E + F = 2\) unifica su combinatoria. El argumento de clasificacion --resolver \((p - 2)(q - 2) < 4\)-- revela que la finitud de los poliedros regulares es un hecho aritmetico profundo, no un accidente.</p>
                            </div>
                            <div class="border-l-2 border-violet-500/50 pl-4">
                                <p class="text-white font-medium mb-1">Modulo 2 -- Mas Alla de Platon (L9-L14)</p>
                                <p class="text-gray-400 text-sm">Relajamos las restricciones. Los 13 solidos de Arquimedes, los duales de Catalan, los 4 poliedros de Kepler-Poinsot. El icosaedro truncado --32 caras, 12 pentagonos y 20 hexagonos-- reaparecera como la molecula de C&#8326;&#8320;. El teorema de los 12 pentagonos nos dice que toda esfera cerrada con caras pentagonales y hexagonales tiene exactamente 12 pentagonos.</p>
                            </div>
                            <div class="border-l-2 border-violet-500/50 pl-4">
                                <p class="text-white font-medium mb-1">Modulo 3 -- Simetria y Algebra (L15-L19)</p>
                                <p class="text-gray-400 text-sm">La teoria de grupos revelo la estructura algebraica oculta. Cada solido tiene un grupo de simetria: \(S_4\) para el cubo, \(A_5\) para el icosaedro, \(I_h\) con 120 elementos. El lema de Burnside conto coloraciones simetricas. La simetria dejo de ser una cualidad estetica para convertirse en un objeto algebraico preciso.</p>
                            </div>
                            <div class="border-l-2 border-violet-500/50 pl-4">
                                <p class="text-white font-medium mb-1">Modulo 4 -- La Cuarta Dimension (L20-L24)</p>
                                <p class="text-gray-400 text-sm">Escapamos de tres dimensiones. En 4D existen 6 politopos regulares; en 5D y superiores, solo 3. El 120-cell y el 600-cell extienden la dualidad dodecaedro-icosaedro a 4D. Los diagramas de Schlegel nos permitieron ver sombras tridimensionales de objetos cuatridimensionales. La formula de Euler-Poincare generalizo \(V - E + F = 2\) a cualquier dimension.</p>
                            </div>
                            <div class="border-l-2 border-violet-500/50 pl-4">
                                <p class="text-white font-medium mb-1">Modulo 5 -- Teoria de Grafos (L25-L29)</p>
                                <p class="text-gray-400 text-sm">Los poliedros se convirtieron en esqueletos combinatorios. El teorema de Steinitz caracterizo los grafos poliedrales. Coloreamos grafos, recorrimos circuitos hamiltonianos (los cinco platonicos los tienen), calculamos polinomios cromaticos y espectros del laplaciano. Los cinco solidos platonicos funcionaron como banco de pruebas perfecto para toda la teoria de grafos.</p>
                            </div>
                            <div class="border-l-2 border-violet-500/50 pl-4">
                                <p class="text-white font-medium mb-1">Modulo 6 -- Aplicaciones Modernas (L30-L33)</p>
                                <p class="text-gray-400 text-sm">La abstraccion se hizo concreta. Los grupos de simetria clasifican cristales reales. La teoria de Caspar-Klug explica por que los virus usan capsides icosaedricas. El teorema de los 12 pentagonos explica la estructura del C&#8326;&#8320;. Y los quasicristales --ordenados pero no periodicos-- vinculan la teselacion de Penrose, las dimensiones superiores y el numero aureo en la estructura misma de la materia.</p>
                            </div>
                        </div>

                        <p class="text-gray-300">
                            Un unico hilo atraviesa todo: los 5 solidos platonicos, nacidos en la antigua Grecia, continuan iluminando las estructuras mas profundas de la naturaleza y la matematica 2400 anios despues. No son reliquias del pasado. Son los arquetipos permanentes de la simetria.
                        </p>
                    </section>

                    <!-- 7. Epilogo: Preguntas Abiertas -->
                    <section class="mb-10">
                        <h3 class="text-xl font-semibold text-violet-400 mb-4">7. Epilogo: Preguntas Abiertas</h3>
                        <p class="text-gray-300 mb-4">
                            El curso termina, pero las preguntas no. Cada leccion ha abierto puertas hacia problemas activos de investigacion. Estas son algunas de las direcciones en las que el material de este curso conecta con la frontera del conocimiento:
                        </p>
                        <ul class="list-none text-gray-300 space-y-4 mb-4">
                            <li>
                                <strong class="text-white">Materiales fotonicos quasicristalinos.</strong> Las teselaciones de Penrose en 2D y sus analogos en 3D pueden disenar cristales fotonicos con band gaps isotropicos, algo imposible con cristales periodicos. Esto tiene aplicaciones potenciales en lasers, guias de onda y sensores opticos.
                            </li>
                            <li>
                                <strong class="text-white">Nuevas proyecciones desde dimensiones superiores.</strong> Si los quasicristales icosaedricos provienen de redes 6D, que estructuras emergen de redes en 7, 8 o 24 dimensiones? La red de Leech en 24D, con sus propiedades excepcionales, podria generar quasicristales aun no imaginados.
                            </li>
                            <li>
                                <strong class="text-white">Topologia de redes de nanotubos.</strong> Como afecta la topologia de una red de nanotubos de carbono a sus propiedades de transporte? Las tecnicas del Modulo 5 --espectros del laplaciano, conectividad algebraica-- son herramientas naturales para este problema.
                            </li>
                            <li>
                                <strong class="text-white">Simetria icosaedrica en mecanica cuantica.</strong> Que papel juega el grupo \(I_h\) en la clasificacion de estados cuanticos? Las representaciones del grupo icosaedrico aparecen en la teoria de orbitales moleculares y en modelos nucleares.
                            </li>
                            <li>
                                <strong class="text-white">Estructuras platonicas en dimensiones superiores.</strong> En dimension \(n \geq 5\), solo existen 3 politopos regulares (el simplex, el hiperoctaedro y el hipercubo). Pero las simetrias de estos objetos contienen subestructuras ricas y poco exploradas.
                            </li>
                        </ul>
                        <p class="text-gray-300">
                            La geometria de los solidos platonicos no es un capitulo cerrado. Es un programa de investigacion vivo, con ramificaciones en la fisica del estado solido, la teoria de numeros, la topologia y la ciencia de materiales. Las herramientas que has adquirido en este curso son las mismas que usan los investigadores que trabajan en estos problemas hoy.
                        </p>
                    </section>

                    <!-- Ejercicios -->
                    <section class="mb-10">
                        <h3 class="text-xl font-semibold text-cyan-400 mb-4">Ejercicios</h3>
                        <div class="bg-gray-900 border border-gray-800 rounded-xl p-6 space-y-4">
                            <div>
                                <p class="text-gray-300"><strong class="text-white">1.</strong> Demuestra la restriccion cristalografica: si una rotacion por angulo \(2\pi/n\) preserva una red en \(\mathbb{R}^2\), entonces la traza de la matriz de rotacion, \(2\cos(2\pi/n)\), debe ser un entero. Deduce de aqui que \(n \in \{1, 2, 3, 4, 6\}\).</p>
                            </div>
                            <div>
                                <p class="text-gray-300"><strong class="text-white">2.</strong> En un parche de teselacion de Penrose se cuentan 100 rombos gordos y 62 rombos flacos. Calcula la razon 100/62 y compara con \(\phi\). Si se amplia el parche a 1000 rombos gordos, cuantos flacos esperarias?</p>
                            </div>
                            <div>
                                <p class="text-gray-300"><strong class="text-white">3.</strong> El patron de difraccion de un quasicristal icosaedrico muestra simetria de orden 10, no de orden 5. Explica por que. (Pista: considera la relacion entre una rotacion de angulo \(\theta\) y la inversión de Friedel, que impone \(I(\mathbf{k}) = I(-\mathbf{k})\) en la intensidad de difraccion.)</p>
                            </div>
                            <div>
                                <p class="text-gray-300"><strong class="text-white">4.</strong> La red cubica \(\mathbb{Z}^6\) tiene cada punto rodeado de cierto numero de vecinos mas cercanos. Cuantos son? Si proyectamos esta red sobre un subespacio 3D elegido apropiadamente, que simetria puede exhibir el quasicristal resultante?</p>
                            </div>
                            <div>
                                <p class="text-gray-300"><strong class="text-white">5.</strong> Traza el numero aureo a traves del curso: da un ejemplo concreto y especifico de cada uno de los 6 modulos donde \(\phi\) aparece, indicando la leccion y la formula o construccion exacta.</p>
                            </div>
                        </div>
                    </section>

                    <!-- Fin del Curso -->
                    <section class="mb-10">
                        <div class="border border-violet-500/30 rounded-2xl p-8 bg-gradient-to-b from-violet-500/5 to-cyan-500/5">
                            <h3 class="text-2xl font-light text-center mb-6">
                                <span class="text-violet-400 glow-text">Fin del Curso</span>
                            </h3>
                            <p class="text-gray-300 text-center text-lg mb-4">
                                Has recorrido 33 lecciones, desde las formas perfectas que Platon imagino en su cueva hasta el laboratorio donde Shechtman vio lo que nadie creia posible.
                            </p>
                            <p class="text-gray-400 text-center mb-4">
                                Comenzamos con una pregunta simple: cuantos poliedros regulares convexos existen? La respuesta --cinco, exactamente cinco-- fue el primer teorema. Pero esa respuesta abrio un universo. La formula de Euler, \(V - E + F = 2\), revelo que la combinatoria de un poliedro esta determinada por la topologia de la esfera. El teorema de clasificacion mostro que la finitud de las formas platonicas no es un accidente geometrico, sino una consecuencia algebraica de una desigualdad entre enteros.
                            </p>
                            <p class="text-gray-400 text-center mb-4">
                                Despues vinieron los solidos de Arquimedes y los poliedros estrellados, la teoria de grupos y Burnside, el paso a cuatro dimensiones y los diagramas de Schlegel, la teoria de grafos y el espectro del laplaciano. Cada capa agrego profundidad sin perder el hilo: los mismos cinco objetos, vistos desde angulos cada vez mas poderosos.
                            </p>
                            <p class="text-gray-400 text-center mb-4">
                                Finalmente, la abstraccion se hizo materia. Las simetrias de grupo clasifican los cristales reales. El principio de Caspar-Klug explica como los virus empaquetan su genoma en capsides icosaedricas. El teorema de Steinitz vincula los grafos planares con los poliedros. El teorema de los 12 pentagonos predice la estructura del C&#8326;&#8320;. Y la teselacion de Penrose, con su simetria pentagonal prohibida, materializo en los quasicristales de Shechtman una estructura que la matematica habia anticipado una decada antes.
                            </p>
                            <p class="text-gray-300 text-center text-lg">
                                El arco que va de la cueva de Platon al microscopio electronico de Shechtman no es una metafora. Es la historia real de como cinco formas simples, miradas con atencion creciente durante dos milenios y medio, revelaron estructuras que gobiernan la materia, la simetria y el espacio en todas las dimensiones.
                            </p>
                        </div>
                    </section>

                    <!-- LAB: Teselacion de Penrose -->
                    <section class="mb-10">
                        <h3 class="text-xl font-semibold text-cyan-400 mb-4">LAB: Teselacion de Penrose</h3>
                        <p class="text-gray-400 mb-4">Genera teselaciones de Penrose interactivas mediante deflacion de triangulos aureos. Observa como la razon entre los dos tipos de pieza converge al numero aureo \(\phi\).</p>

                        <div class="bg-gray-900 border border-gray-800 rounded-xl overflow-hidden">
                            <!-- Controls -->
                            <div class="flex flex-wrap items-center gap-2 px-4 py-3 border-b border-gray-800">
                                <button id="btn-deflate" class="px-3 py-1.5 rounded-lg text-sm bg-violet-500/20 text-violet-400 border border-violet-500/30 hover:bg-violet-500/30 transition">Deflacionar</button>
                                <button id="btn-inflate" class="px-3 py-1.5 rounded-lg text-sm bg-gray-800 border border-gray-700 text-gray-400 hover:text-violet-400 transition">Inflacionar</button>
                                <button id="btn-edges" class="px-3 py-1.5 rounded-lg text-sm bg-cyan-500/20 text-cyan-400 border border-cyan-500/30 hover:bg-cyan-500/30 transition">Bordes: ON</button>
                                <button id="btn-symmetry" class="px-3 py-1.5 rounded-lg text-sm bg-gray-800 border border-gray-700 text-gray-400 hover:text-cyan-400 transition">Simetria: OFF</button>
                            </div>
                            <!-- Info -->
                            <div class="flex flex-wrap justify-center gap-4 px-4 py-2 border-b border-gray-800 text-sm mono">
                                <span class="text-gray-400">Nivel: <span id="lab-level" class="text-violet-400">3</span></span>
                                <span class="text-gray-400">Gordos: <span id="lab-fat" class="text-cyan-400">--</span></span>
                                <span class="text-gray-400">Flacos: <span id="lab-thin" class="text-violet-400">--</span></span>
                                <span class="text-gray-400">Razon: <span id="lab-ratio" class="text-white">--</span></span>
                                <span class="text-gray-400">&phi; = <span class="text-cyan-400">1.6180...</span></span>
                            </div>
                            <!-- Canvas -->
                            <div id="lab-container" class="w-full bg-black" style="height: 520px; position: relative;">
                                <canvas id="lab-canvas" style="position:absolute;top:0;left:0;width:100%;height:100%;"></canvas>
                            </div>
                        </div>
                    </section>

                    <!-- Bottom Navigation -->
                    <div class="mt-12 pt-8 border-t border-gray-800 flex justify-between items-center">
                        <a href="./leccion-32.html" class="px-6 py-3 bg-gray-900 hover:bg-gray-800 rounded-lg text-gray-300 transition">&larr; Anterior</a>
                        <a href="../index.html" class="px-6 py-3 bg-violet-500/10 text-violet-400 hover:bg-violet-500/20 rounded-lg transition">Volver al Curso &rarr;</a>
                    </div>
                </article>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer class="border-t border-gray-900 py-6 mt-12">
        <div class="max-w-6xl mx-auto px-6">
            <nav class="text-xs text-gray-600 text-center mb-2">
                <a href="../../../../../_portal/index.html" class="hover:text-violet-400 transition">EigenLab</a>
                <span class="mx-1">/</span>
                <a href="../../../index.html" class="hover:text-violet-400 transition">Math Visual Lab</a>
                <span class="mx-1">/</span>
                <a href="../../index.html" class="hover:text-violet-400 transition">Platonic Lab</a>
                <span class="mx-1">/</span>
                <a href="../index.html" class="hover:text-violet-400 transition">Curso</a>
            </nav>
            <p class="text-center text-gray-700 text-sm mono">Matematicas Visuales -- De Platon a 4D</p>
        </div>
    </footer>

    <script>
    // ============================================================
    // CONSTANTS
    // ============================================================
    var PHI = (1 + Math.sqrt(5)) / 2;

    // ============================================================
    // ILLUSTRATION 1: Penrose Tiling (static patch)
    // Uses Robinson triangle decomposition
    // ============================================================
    (function() {
        var c = document.getElementById('penrose-canvas');
        if (!c) return;
        var W = c.clientWidth, H = c.clientHeight;
        var dpr = window.devicePixelRatio || 1;
        c.width = W * dpr; c.height = H * dpr;
        var ctx = c.getContext('2d');
        ctx.scale(dpr, dpr);

        // Robinson triangle types:
        // type 0 = acute (tall) golden gnomon: apex angle 36 deg
        // type 1 = obtuse (flat) golden triangle: apex angle 108 deg
        // Each triangle: { type, A, B, C } where A is the apex

        function deflate(triangles) {
            var result = [];
            for (var i = 0; i < triangles.length; i++) {
                var t = triangles[i];
                var A = t.A, B = t.B, C = t.C;
                if (t.type === 0) {
                    // Acute (36-72-72) -> split
                    var P = [A[0] + (B[0] - A[0]) / PHI, A[1] + (B[1] - A[1]) / PHI];
                    result.push({ type: 0, A: C, B: P, C: A });
                    result.push({ type: 1, A: P, B: C, C: B });
                } else {
                    // Obtuse (108-36-36) -> split
                    var Q = [B[0] + (A[0] - B[0]) / PHI, B[1] + (A[1] - B[1]) / PHI];
                    var R = [B[0] + (C[0] - B[0]) / PHI, B[1] + (C[1] - B[1]) / PHI];
                    result.push({ type: 1, A: R, B: C, C: A });
                    result.push({ type: 1, A: Q, B: R, C: B });
                    result.push({ type: 0, A: R, B: Q, C: A });
                }
            }
            return result;
        }

        // Create initial "sun" configuration: 10 acute triangles around center
        var cx = W / 2, cy = H / 2;
        var radius = Math.min(W, H) * 0.44;
        var triangles = [];
        for (var i = 0; i < 10; i++) {
            var a1 = (2 * Math.PI * i / 10) - Math.PI / 2;
            var a2 = (2 * Math.PI * (i + 1) / 10) - Math.PI / 2;
            var B = [cx + radius * Math.cos(a1), cy + radius * Math.sin(a1)];
            var C = [cx + radius * Math.cos(a2), cy + radius * Math.sin(a2)];
            if (i % 2 === 0) {
                triangles.push({ type: 0, A: [cx, cy], B: B, C: C });
            } else {
                triangles.push({ type: 0, A: [cx, cy], B: C, C: B });
            }
        }

        // Deflate 4 times for a nice detailed pattern
        for (var d = 0; d < 4; d++) {
            triangles = deflate(triangles);
        }

        // Draw triangles
        for (var i = 0; i < triangles.length; i++) {
            var t = triangles[i];
            ctx.beginPath();
            ctx.moveTo(t.A[0], t.A[1]);
            ctx.lineTo(t.B[0], t.B[1]);
            ctx.lineTo(t.C[0], t.C[1]);
            ctx.closePath();
            if (t.type === 0) {
                ctx.fillStyle = 'rgba(34, 211, 238, 0.25)';
            } else {
                ctx.fillStyle = 'rgba(167, 139, 250, 0.25)';
            }
            ctx.fill();
            ctx.strokeStyle = 'rgba(167, 139, 250, 0.3)';
            ctx.lineWidth = 0.5;
            ctx.stroke();
        }

        // Draw center dot
        ctx.beginPath();
        ctx.arc(cx, cy, 4, 0, Math.PI * 2);
        ctx.fillStyle = '#a78bfa';
        ctx.fill();

        // Legend
        ctx.fillStyle = 'rgba(34, 211, 238, 0.7)';
        ctx.fillRect(16, H - 36, 12, 12);
        ctx.fillStyle = '#9ca3af';
        ctx.font = '11px Inter, sans-serif';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';
        ctx.fillText('Agudo (gnomon)', 34, H - 30);

        ctx.fillStyle = 'rgba(167, 139, 250, 0.7)';
        ctx.fillRect(16, H - 18, 12, 12);
        ctx.fillStyle = '#9ca3af';
        ctx.fillText('Obtuso (triangulo aureo)', 34, H - 12);
    })();

    // ============================================================
    // ILLUSTRATION 2: Diffraction Pattern with 10-fold symmetry
    // ============================================================
    (function() {
        var c = document.getElementById('diffraction-canvas');
        if (!c) return;
        var W = c.clientWidth, H = c.clientHeight;
        var dpr = window.devicePixelRatio || 1;
        c.width = W * dpr; c.height = H * dpr;
        var ctx = c.getContext('2d');
        ctx.scale(dpr, dpr);

        var cx = W / 2, cy = H / 2;
        var maxR = Math.min(W, H) * 0.45;

        // Background glow
        var bgGrad = ctx.createRadialGradient(cx, cy, 0, cx, cy, maxR * 1.2);
        bgGrad.addColorStop(0, 'rgba(167, 139, 250, 0.06)');
        bgGrad.addColorStop(1, 'rgba(0, 0, 0, 0)');
        ctx.fillStyle = bgGrad;
        ctx.fillRect(0, 0, W, H);

        // Generate diffraction spots using a quasicrystalline reciprocal lattice
        // 5 basis vectors at 72-degree intervals
        var basis = [];
        for (var i = 0; i < 5; i++) {
            var angle = 2 * Math.PI * i / 5;
            basis.push([Math.cos(angle), Math.sin(angle)]);
        }

        // Generate points using integer combinations of basis vectors
        var spots = [];
        var range = 5;
        for (var n0 = -range; n0 <= range; n0++) {
            for (var n1 = -range; n1 <= range; n1++) {
                for (var n2 = -range; n2 <= range; n2++) {
                    for (var n3 = -range; n3 <= range; n3++) {
                        var kx = n0 * basis[0][0] + n1 * basis[1][0] + n2 * basis[2][0] + n3 * basis[3][0];
                        var ky = n0 * basis[0][1] + n1 * basis[1][1] + n2 * basis[2][1] + n3 * basis[3][1];
                        var dist = Math.sqrt(kx * kx + ky * ky);
                        if (dist < 5.5 && dist > 0.01) {
                            var intensity = Math.exp(-dist * 0.5);
                            var indices = Math.abs(n0) + Math.abs(n1) + Math.abs(n2) + Math.abs(n3);
                            intensity *= Math.exp(-indices * 0.15);
                            spots.push({ x: kx, y: ky, intensity: intensity });
                        }
                    }
                }
            }
        }

        // Normalize and draw
        var scale = maxR / 5.5;

        // Sort by intensity (draw dim first)
        spots.sort(function(a, b) { return a.intensity - b.intensity; });

        for (var i = 0; i < spots.length; i++) {
            var s = spots[i];
            var sx = cx + s.x * scale;
            var sy = cy + s.y * scale;
            var r = Math.max(1, s.intensity * 5);
            var alpha = Math.min(1, s.intensity * 1.5);

            var grad = ctx.createRadialGradient(sx, sy, 0, sx, sy, r * 2.5);
            grad.addColorStop(0, 'rgba(255, 255, 255, ' + alpha + ')');
            grad.addColorStop(0.3, 'rgba(167, 139, 250, ' + (alpha * 0.7) + ')');
            grad.addColorStop(1, 'rgba(34, 211, 238, 0)');
            ctx.fillStyle = grad;
            ctx.beginPath();
            ctx.arc(sx, sy, r * 2.5, 0, Math.PI * 2);
            ctx.fill();

            // Bright core
            ctx.beginPath();
            ctx.arc(sx, sy, r, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255, 255, 255, ' + (alpha * 0.9) + ')';
            ctx.fill();
        }

        // Central bright spot
        var cGrad = ctx.createRadialGradient(cx, cy, 0, cx, cy, 8);
        cGrad.addColorStop(0, 'rgba(255, 255, 255, 1)');
        cGrad.addColorStop(0.3, 'rgba(167, 139, 250, 0.8)');
        cGrad.addColorStop(1, 'rgba(34, 211, 238, 0)');
        ctx.fillStyle = cGrad;
        ctx.beginPath();
        ctx.arc(cx, cy, 8, 0, Math.PI * 2);
        ctx.fill();

        // Label
        ctx.fillStyle = '#6b7280';
        ctx.font = '11px Inter, sans-serif';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'bottom';
        ctx.fillText('Simetria 10-fold', 16, H - 8);
    })();

    // ============================================================
    // LAB: Interactive Penrose Tiling Generator
    // Robinson triangle deflation with controls
    // ============================================================
    (function() {
        var container = document.getElementById('lab-container');
        var canvas = document.getElementById('lab-canvas');
        if (!container || !canvas) return;

        var W, H, dpr, ctx;
        var currentLevel = 3;
        var maxLevel = 6;
        var showEdges = true;
        var showSymmetry = false;
        var trianglesCache = {};

        function resize() {
            W = container.clientWidth;
            H = container.clientHeight;
            dpr = window.devicePixelRatio || 1;
            canvas.width = W * dpr;
            canvas.height = H * dpr;
            ctx = canvas.getContext('2d');
            ctx.scale(dpr, dpr);
        }

        function createSun() {
            var cx = W / 2, cy = H / 2;
            var radius = Math.min(W, H) * 0.46;
            var triangles = [];
            for (var i = 0; i < 10; i++) {
                var a1 = (2 * Math.PI * i / 10) - Math.PI / 2;
                var a2 = (2 * Math.PI * (i + 1) / 10) - Math.PI / 2;
                var B = [cx + radius * Math.cos(a1), cy + radius * Math.sin(a1)];
                var C = [cx + radius * Math.cos(a2), cy + radius * Math.sin(a2)];
                if (i % 2 === 0) {
                    triangles.push({ type: 0, A: [cx, cy], B: B, C: C });
                } else {
                    triangles.push({ type: 0, A: [cx, cy], B: C, C: B });
                }
            }
            return triangles;
        }

        function deflate(triangles) {
            var result = [];
            for (var i = 0; i < triangles.length; i++) {
                var t = triangles[i];
                var A = t.A, B = t.B, C = t.C;
                if (t.type === 0) {
                    var P = [A[0] + (B[0] - A[0]) / PHI, A[1] + (B[1] - A[1]) / PHI];
                    result.push({ type: 0, A: C, B: P, C: A });
                    result.push({ type: 1, A: P, B: C, C: B });
                } else {
                    var Q = [B[0] + (A[0] - B[0]) / PHI, B[1] + (A[1] - B[1]) / PHI];
                    var R = [B[0] + (C[0] - B[0]) / PHI, B[1] + (C[1] - B[1]) / PHI];
                    result.push({ type: 1, A: R, B: C, C: A });
                    result.push({ type: 1, A: Q, B: R, C: B });
                    result.push({ type: 0, A: R, B: Q, C: A });
                }
            }
            return result;
        }

        function getTriangles(level) {
            // Build from scratch each time (positions depend on canvas size)
            var tris = createSun();
            for (var d = 0; d < level; d++) {
                tris = deflate(tris);
            }
            return tris;
        }

        // Merge adjacent triangles into rhombuses for display
        // Two triangles sharing their longest edge form a rhombus
        function mergeToRhombuses(triangles) {
            var EPS = 0.5;
            var used = new Array(triangles.length);
            for (var i = 0; i < used.length; i++) used[i] = false;
            var rhombuses = [];

            function ptEq(p, q) {
                return Math.abs(p[0] - q[0]) < EPS && Math.abs(p[1] - q[1]) < EPS;
            }

            for (var i = 0; i < triangles.length; i++) {
                if (used[i]) continue;
                var ti = triangles[i];
                var matched = false;
                for (var j = i + 1; j < triangles.length; j++) {
                    if (used[j]) continue;
                    var tj = triangles[j];
                    if (ti.type !== tj.type) continue;
                    // Check if they share edge B-C (the base)
                    if ((ptEq(ti.B, tj.B) && ptEq(ti.C, tj.C)) ||
                        (ptEq(ti.B, tj.C) && ptEq(ti.C, tj.B))) {
                        // Form rhombus: A_i, B, A_j, C
                        rhombuses.push({
                            type: ti.type,
                            pts: [ti.A, ti.B, tj.A, ti.C]
                        });
                        used[i] = true;
                        used[j] = true;
                        matched = true;
                        break;
                    }
                }
                if (!matched) {
                    // Unmatched triangle: draw as is
                    rhombuses.push({
                        type: ti.type,
                        pts: [ti.A, ti.B, ti.C],
                        isTri: true
                    });
                    used[i] = true;
                }
            }
            return rhombuses;
        }

        function draw() {
            ctx.clearRect(0, 0, W, H);
            var triangles = getTriangles(currentLevel);

            // Count types
            var acuteCount = 0, obtuseCount = 0;
            for (var i = 0; i < triangles.length; i++) {
                if (triangles[i].type === 0) acuteCount++;
                else obtuseCount++;
            }

            // For rhombus display: each pair of same-type triangles forms a rhombus
            // "Fat" rhombus = 2 obtuse triangles, "Thin" rhombus = 2 acute triangles
            var fatCount = Math.floor(obtuseCount / 2);
            var thinCount = Math.floor(acuteCount / 2);

            // Update info
            document.getElementById('lab-level').textContent = currentLevel;
            document.getElementById('lab-fat').textContent = fatCount;
            document.getElementById('lab-thin').textContent = thinCount;
            var ratio = thinCount > 0 ? (fatCount / thinCount).toFixed(4) : '--';
            document.getElementById('lab-ratio').textContent = ratio;

            // Try to merge into rhombuses
            var shapes = mergeToRhombuses(triangles);

            // Draw shapes
            for (var i = 0; i < shapes.length; i++) {
                var s = shapes[i];
                ctx.beginPath();
                ctx.moveTo(s.pts[0][0], s.pts[0][1]);
                for (var j = 1; j < s.pts.length; j++) {
                    ctx.lineTo(s.pts[j][0], s.pts[j][1]);
                }
                ctx.closePath();

                // Color based on type
                if (s.type === 1) {
                    // Obtuse triangles -> fat rhombus -> cyan
                    ctx.fillStyle = 'rgba(34, 211, 238, 0.2)';
                } else {
                    // Acute triangles -> thin rhombus -> violet
                    ctx.fillStyle = 'rgba(167, 139, 250, 0.2)';
                }
                ctx.fill();

                if (showEdges) {
                    ctx.strokeStyle = s.type === 1 ? 'rgba(34, 211, 238, 0.45)' : 'rgba(167, 139, 250, 0.45)';
                    ctx.lineWidth = currentLevel >= 5 ? 0.3 : (currentLevel >= 4 ? 0.5 : 0.8);
                    ctx.stroke();
                }
            }

            // Draw vertices as small dots
            if (currentLevel <= 4) {
                var drawnPts = {};
                for (var i = 0; i < triangles.length; i++) {
                    var t = triangles[i];
                    var points = [t.A, t.B, t.C];
                    for (var j = 0; j < 3; j++) {
                        var key = Math.round(points[j][0]) + ',' + Math.round(points[j][1]);
                        if (!drawnPts[key]) {
                            drawnPts[key] = true;
                            ctx.beginPath();
                            ctx.arc(points[j][0], points[j][1], 1.2, 0, Math.PI * 2);
                            ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                            ctx.fill();
                        }
                    }
                }
            }

            // Symmetry overlay
            if (showSymmetry) {
                var cx = W / 2, cy = H / 2;
                var symR = Math.min(W, H) * 0.44;

                // Draw 5-fold symmetry lines
                ctx.setLineDash([6, 4]);
                for (var i = 0; i < 5; i++) {
                    var angle = (2 * Math.PI * i / 5) - Math.PI / 2;
                    ctx.beginPath();
                    ctx.moveTo(cx, cy);
                    ctx.lineTo(cx + symR * Math.cos(angle), cy + symR * Math.sin(angle));
                    ctx.strokeStyle = 'rgba(167, 139, 250, 0.5)';
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                }
                ctx.setLineDash([]);

                // Center marker
                ctx.beginPath();
                ctx.arc(cx, cy, 6, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(167, 139, 250, 0.7)';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Label
                ctx.fillStyle = 'rgba(167, 139, 250, 0.7)';
                ctx.font = '12px "JetBrains Mono", monospace';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';
                ctx.fillText('C\u2085', cx, cy + 12);
            }
        }

        // Button events
        document.getElementById('btn-deflate').addEventListener('click', function() {
            if (currentLevel < maxLevel) {
                currentLevel++;
                draw();
            }
        });

        document.getElementById('btn-inflate').addEventListener('click', function() {
            if (currentLevel > 0) {
                currentLevel--;
                draw();
            }
        });

        document.getElementById('btn-edges').addEventListener('click', function() {
            showEdges = !showEdges;
            this.textContent = 'Bordes: ' + (showEdges ? 'ON' : 'OFF');
            if (showEdges) {
                this.className = 'px-3 py-1.5 rounded-lg text-sm bg-cyan-500/20 text-cyan-400 border border-cyan-500/30 hover:bg-cyan-500/30 transition';
            } else {
                this.className = 'px-3 py-1.5 rounded-lg text-sm bg-gray-800 border border-gray-700 text-gray-400 hover:text-cyan-400 transition';
            }
            draw();
        });

        document.getElementById('btn-symmetry').addEventListener('click', function() {
            showSymmetry = !showSymmetry;
            this.textContent = 'Simetria: ' + (showSymmetry ? 'ON' : 'OFF');
            if (showSymmetry) {
                this.className = 'px-3 py-1.5 rounded-lg text-sm bg-cyan-500/20 text-cyan-400 border border-cyan-500/30 hover:bg-cyan-500/30 transition';
            } else {
                this.className = 'px-3 py-1.5 rounded-lg text-sm bg-gray-800 border border-gray-700 text-gray-400 hover:text-cyan-400 transition';
            }
            draw();
        });

        // Init
        resize();
        draw();
        window.addEventListener('resize', function() {
            resize();
            draw();
        });
    })();
    </script>
</body>
</html>
